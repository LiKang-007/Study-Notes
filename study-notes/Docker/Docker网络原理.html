<html>
<head>
  <title>Docker网络原理</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/602916 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="5546"/>
<h1>Docker网络原理</h1>

<div>
<span><div><span style="font-size: 12pt; font-style: italic; font-weight: bold;">理解Docker0</span></div><div>    使用 ip addr 查看网卡</div><div>        1、lo 本机回环地址</div><div>        2、eth0 本机网卡</div><div>        3、docker0 docker生成的网卡</div><div><br/></div><div>    问题：docker是如何处理容器之间的网络访问的？</div><div><img src="Docker网络原理_files/Image.png" type="image/png" data-filename="Image.png"/></div><div><img src="Docker网络原理_files/Image [1].png" type="image/png" data-filename="Image.png"/></div><div>原理：</div><div>    <img src="Docker网络原理_files/Image [2].png" type="image/png" data-filename="Image.png"/></div><div><img src="Docker网络原理_files/Image [3].png" type="image/png" data-filename="Image.png"/></div><div><img src="Docker网络原理_files/Image [4].png" type="image/png" data-filename="Image.png"/></div><div><img src="Docker网络原理_files/Image [5].png" type="image/png" data-filename="Image.png"/></div><div>网络模型图：</div><div><img src="Docker网络原理_files/Image [6].png" type="image/png" data-filename="Image.png"/></div><div><img src="Docker网络原理_files/Image [7].png" type="image/png" data-filename="Image.png"/></div><div><img src="Docker网络原理_files/Image [8].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div><span style="font-size: 12pt; font-weight: bold;">容器互联 --link：</span></div><div><img src="Docker网络原理_files/Image [9].png" type="image/png" data-filename="Image.png"/></div><div>反向要ping通，也必须配置。</div><div>    探究link命令的原理：</div><div>        docker network</div><div><img src="Docker网络原理_files/Image [10].png" type="image/png" data-filename="Image.png"/></div><div><img src="Docker网络原理_files/Image [11].png" type="image/png" data-filename="Image.png"/></div><div><img src="Docker网络原理_files/Image [12].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div><span style="font-size: 14pt; font-weight: bold;">自定义网络：</span></div><div><img src="Docker网络原理_files/Image [13].png" type="image/png" data-filename="Image.png"/></div><div><span style="font-size: 12pt; font-weight: bold;">网络模式：</span></div><div>    bridge：桥接模式（默认，自定义网络也使用桥接模式）</div><div>    none：不配置网络</div><div>    host：和宿主机共享网络</div><div>    container：容器内网络连通！（用的少！局限很大）（多个容器共享一个ip（网卡））</div><div>    在启动容器的时候，--net 参数默认就是 bridge</div><div><img src="Docker网络原理_files/Image [14].png" type="image/png" data-filename="Image.png"/></div><div>之后启动容器，就可以放到自定义网络中了。</div><div><img src="Docker网络原理_files/Image [15].png" type="image/png" data-filename="Image.png"/></div><div>将新创建的容器都使用自定义网络</div><div><img src="Docker网络原理_files/Image [16].png" type="image/png" data-filename="Image.png"/></div><div>自定义的网络docker已经帮我们维护好了对应的关系，推荐使用！</div><div><br/></div><div><span style="font-size: 12pt; font-weight: bold;">好处：</span></div><div>    readis集群、mysql集群-不同的集群使用不同的网络，保证集群的安全和健康的。</div><div><br/></div><div><span style="font-size: 12pt; font-weight: bold;">网络连通</span></div><div><img src="Docker网络原理_files/Image [17].png" type="image/png" data-filename="Image.png"/></div><div><img src="Docker网络原理_files/Image [18].png" type="image/png" data-filename="Image.png"/></div><div>        容器连接到一个网络上。</div><div><img src="Docker网络原理_files/Image [19].png" type="image/png" data-filename="Image.png"/></div><div><img src="Docker网络原理_files/Image [20].png" type="image/png" data-filename="Image.png"/></div><div><img src="Docker网络原理_files/Image [21].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div><span style="font-size: 12pt; font-weight: bold;">结论</span>：docker自己有四种网络模式：</div><div>        bridge：桥接模式（默认，自定义网络也使用桥接模式）</div><div>        none：不配置网络</div><div>        host：和宿主机共享网络</div><div>        container：容器内网络连通！（用的少！局限很大）</div><div>    默认使用的是 bridge模式，使用evth-path技术连接 Docker0（相当于交换机），但是这个网络内的容器之间不能通过容器名或者容器ID连接，可以通过link 解决，但是一次只能设置一个（比如容器1---&gt;容奇2,并且是单向，反向则不行,容器2不能通过容器名访问容器1） 。可以使用自定义网络，自定义网络中的全部容器都可以相互通过容器名访问，跨网络可以通过docker network connect命令实现（原理直接将需要连接的容器加入指定网络，一个容器多个ip，相当于配置了多个网卡）。推荐使用自定义网络，安全。</div><div><br/></div><div><br/></div><div><br/></div><div>实战：</div><div>    部署redis集群</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>#创建redis网络</div><div>docker network create redis --subnet 172.38.0.0/16</div><div><br/></div><div>#通过shell脚本创建六个redis配置</div><div>for port in $(seq 1 6); \</div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">do \</span></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">mkdir -p /mkdata/redis/node-${port}/conf</span></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">touch /mydata/redis/node-${port}/conf/redis.conf</span></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">cat &lt;&lt; EOF &gt;/mydata/redis/node-${port}/conf/redis.conf</span></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">port 6379</span></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">bind 0.0.0.0</span></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">cluster-enabled yes</span></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">cluster-config-file nodes.conf</span></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">cluster-node-timeout 5000</span></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">cluster-announce-ip 172.38.0.1${port}</span></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">cluster-announce-port 6370</span></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">cluster-announce-bus-port 16379</span></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">appendonly yes</span></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">EOF</span></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">done</span></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;"><br/></span></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">#开启一个redis容器</span></div><div><font face="Monaco">docker run -p 6371:6379 -p 16371:16379 --name redis-1 \</font></div><div><font face="Monaco">-v /mydata/redis/node-1/data:/data \</font></div><div><font face="Monaco">-v /mydata/redis/node-1/conf/redis.conf:/etc/redis/redis.conf \</font></div><div><font face="Monaco">-d --net redis --ip 172.38.0.11 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf</font></div><div><font face="Monaco"><br/></font></div><div><font face="Monaco">#随便进入一个redis容器</font></div><div><font face="Monaco">docker exec -it redis-1 /bin/sh</font></div><div><font face="Monaco">#配置redis 集群</font></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">redis -cli --cluster create 172.38.0.11:6379 </span>172.38.0.12:6379 172.38.0.13:6379 172.38.0.14:6379 172.38.0.15:6379 172.38.0.16:6379 --cluster-replicas 1</div></div><div><br/></div></span>
</div></body></html> 