<html>
<head>
  <title>类加载和字节码技术2</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/602916 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="3655"/>
<h1>类加载和字节码技术2</h1>

<div>
<span><div><span style="font-size: 12pt; font-weight: bold;">2、4 练习-分析i++</span></div><div><img src="类加载和字节码技术2_files/Image.png" type="image/png" data-filename="Image.png"/></div><div>a++ 是先iload(入栈)再iinc</div><div>++a是先iinc再iload</div><div><img src="类加载和字节码技术2_files/Image [1].png" type="image/png" data-filename="Image.png"/></div><div><img src="类加载和字节码技术2_files/Image [2].png" type="image/png" data-filename="Image.png"/></div><div><img src="类加载和字节码技术2_files/Image [3].png" type="image/png" data-filename="Image.png"/></div><div><img src="类加载和字节码技术2_files/Image [4].png" type="image/png" data-filename="Image.png"/></div><div><img src="类加载和字节码技术2_files/Image [5].png" type="image/png" data-filename="Image.png"/></div><div><img src="类加载和字节码技术2_files/Image [6].png" type="image/png" data-filename="Image.png"/></div><div><img src="类加载和字节码技术2_files/Image [7].png" type="image/png" data-filename="Image.png"/></div><div><img src="类加载和字节码技术2_files/Image [8].png" type="image/png" data-filename="Image.png"/></div><div><img src="类加载和字节码技术2_files/Image [9].png" type="image/png" data-filename="Image.png"/></div><div><img src="类加载和字节码技术2_files/Image [10].png" type="image/png" data-filename="Image.png"/></div><div><span style="font-size: 12pt; font-weight: bold;">2、5 条件判断指令</span></div><div><img src="类加载和字节码技术2_files/Image [11].png" type="image/png" data-filename="Image.png"/></div><div><img src="类加载和字节码技术2_files/Image [12].png" type="image/png" data-filename="Image.png"/></div><div><span style="font-weight: bold;">说明：</span></div><div>    byte，shot，char都会按照int比较，因为操作数栈都是4字节</div><div>    goto 用来进行跳转到指定行号的字节码</div><div><span style="font-weight: bold;">源码：</span></div><div><img src="类加载和字节码技术2_files/Image [13].png" type="image/png" data-filename="Image.png"/></div><div><img src="类加载和字节码技术2_files/Image [14].png" type="image/png" data-filename="Image.png"/></div><div><img src="类加载和字节码技术2_files/Image [15].png" type="image/png" data-filename="Image.png"/></div><div><span style="font-size: 12pt; font-weight: bold;">2、6 循环控制指令</span></div><div><span style="font-size: 12pt;"><span style="font-size: 12pt; font-weight: bold;"><img src="类加载和字节码技术2_files/Image [16].png" type="image/png" data-filename="Image.png"/></span></span></div><div><span style="font-size: 12pt;"><span style="font-size: 12pt; font-weight: bold;"><img src="类加载和字节码技术2_files/Image [17].png" type="image/png" data-filename="Image.png"/></span></span></div><div><span style="font-size: 12pt;"><span style="font-size: 12pt; font-weight: bold;"><img src="类加载和字节码技术2_files/Image [18].png" type="image/png" data-filename="Image.png"/></span></span></div><div><span style="font-size: 12pt;"><span style="font-size: 12pt; font-weight: bold;"><img src="类加载和字节码技术2_files/Image [19].png" type="image/png" data-filename="Image.png"/></span></span></div><div><span style="font-size: 12pt;"><span style="font-size: 12pt; font-weight: bold;"><img src="类加载和字节码技术2_files/Image [20].png" type="image/png" data-filename="Image.png"/></span></span></div><div><span style="font-size: 12pt;"><span style="font-size: 12pt; font-weight: bold;"><img src="类加载和字节码技术2_files/Image [21].png" type="image/png" data-filename="Image.png"/></span></span></div><div><span style="font-size: 12pt;"><span style="font-size: 12pt; font-weight: bold;"><img src="类加载和字节码技术2_files/Image [22].png" type="image/png" data-filename="Image.png"/></span></span></div><div><span style="font-size: 12pt;"><span style="font-size: 12pt; font-weight: bold;">2、7 练习—判断结果</span></span></div><div><span style="font-size: 12pt;"><span style="font-size: 12pt; font-weight: bold;"><img src="类加载和字节码技术2_files/Image [23].png" type="image/png" data-filename="Image.png"/></span></span></div><div><span style="font-size: 12pt;"><span style="font-size: 12pt; font-weight: bold;">2、8 构造方法</span></span></div><div><span style="font-size: 16px;"><span style="font-size: 16px; font-weight: bold;">第一类：&lt;cinit&gt;()V</span></span></div><div><span style="font-size: 12pt;"><span style="font-size: 12pt; font-weight: bold;"><img src="类加载和字节码技术2_files/Image [24].png" type="image/png" data-filename="Image.png"/></span></span></div><div><span style="font-size: 12pt;"><span style="font-size: 12pt; font-weight: bold;"><img src="类加载和字节码技术2_files/Image [25].png" type="image/png" data-filename="Image.png"/></span></span></div><div><span style="font-size: 11pt; font-weight: bold;">编译器会按照从上至下的顺序，收集所有的static静态代码块和静态成员赋值的代码，合并为一个特殊的方法</span></div><div><span style="font-size: 11pt; font-weight: bold;">&lt;cinit&gt;()V</span></div><div><span style="font-size: 11pt; font-weight: bold;">&lt;cinit&gt;()V方法会在类加载的初始化阶段被调用</span></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><span style="font-size: 12pt; font-weight: bold;">第二类：&lt;init&gt;()V</span></div><div><span style="font-size: 11pt;"><span style="font-size: 11pt; font-weight: bold;"><img src="类加载和字节码技术2_files/Image [26].png" type="image/png" data-filename="Image.png"/></span></span></div><div><span style="font-size: 14.6667px;"><span style="font-size: 14.6667px; font-weight: bold;">编译器会按照从上至下的顺序，收集所有{}代码块和成员变量赋值的代码，形成新的构造方法，但原始构造方法内的代码总是在最后</span></span></div><div><span style="font-size: 14.6667px;"><br/></span></div><div><span style="font-size: 14.6667px;"><span style="font-size: 14.6667px; font-weight: bold;">新的构造方法的执行顺序;</span></span></div><div><span style="font-size: 14.6667px;"><span style="font-size: 14.6667px; font-weight: bold;">    a=&quot;s1&quot;;</span></span></div><div><span style="font-size: 14.6667px;"><span style="font-size: 14.6667px; font-weight: bold;">    b=20;</span></span></div><div><span style="font-size: 14.6667px;"><span style="font-size: 14.6667px; font-weight: bold;">    b=10;</span></span></div><div><span style="font-size: 14.6667px;"><span style="font-size: 14.6667px; font-weight: bold;">    a=&quot;s2&quot;;</span></span></div><div><span style="font-size: 14.6667px;"><span style="font-size: 14.6667px; font-weight: bold;">    this.a=a;</span></span></div><div><span style="font-size: 14.6667px;"><span style="font-size: 14.6667px; font-weight: bold;">    this.b=b;</span></span></div><div><span style="font-size: 11pt;"><span style="font-size: 11pt; font-weight: bold;"><img src="类加载和字节码技术2_files/Image [27].png" type="image/png" data-filename="Image.png"/></span></span></div><div><span style="font-size: 11pt;"><span style="font-size: 11pt; font-weight: bold;">2、9 方法调用</span></span></div><div><span style="font-size: 11pt;"><span style="font-size: 11pt; font-weight: bold;"><img src="类加载和字节码技术2_files/Image [28].png" type="image/png" data-filename="Image.png"/></span></span></div><div><span style="font-size: 14.6667px;"><span style="font-size: 14.6667px; font-weight: bold;">字节码：</span></span></div><div><span style="font-size: 11pt;"><span style="font-size: 11pt; font-weight: bold;"><img src="类加载和字节码技术2_files/Image [29].png" type="image/png" data-filename="Image.png"/></span></span></div><div><span style="font-size: 11pt;"><span style="font-size: 11pt; font-weight: bold;">invokespecial 调用构造方法</span></span></div><div><span style="font-size: 11pt;"><span style="font-size: 11pt; font-weight: bold;">invokespecial  私有方法</span></span></div><div><span style="font-size: 14.6667px;"><span style="font-size: 14.6667px; font-weight: bold;">invokespecial  final方法</span></span></div><div><span style="font-size: 14.6667px;"><span style="font-size: 14.6667px; font-weight: bold;">invokevirtual 普通public方法</span></span></div><div><span style="font-size: 14.6667px;"><span style="font-size: 14.6667px; font-weight: bold;">invokestatic 静态方法</span></span></div><div><span style="font-size: 14.6667px;"><br/></span></div><div><span style="font-size: 14.6667px; color: unset; font-family: unset; font-weight: bold;">invokespecial</span><span style="font-size: 14.6667px;"><span style="font-size: 14.6667px; color: unset; font-family: unset; font-weight: bold;">  、</span></span><span style="font-size: 14.6667px; color: unset; font-family: unset; font-weight: bold;">invokestatic 属于静态绑定，性能更高</span></div><div><span style="font-size: 14.6667px;"><br/></span></div><div><span style="font-size: 14.6667px;"><span style="font-size: 14.6667px; font-weight: bold;">new关键字， 调用构造方法的时候，首先在堆空间分配了一个该对象需要的内存，new实际上是分了两步，第一步是给它分配内存，分配成功它会把该对象的引用放入操作数栈，dup指令是把栈顶的地址进行复制，invokespecial会将栈顶的对象引用 ，根据它去调用对应的构造方法，调用结束将该引用从栈顶清除，astore_1是将剩余的引用存入到局部变量表中的d变量。</span></span></div><div><span style="font-size: 11pt;"><span style="font-size: 11pt; font-weight: bold;"><img src="类加载和字节码技术2_files/Image [30].png" type="image/png" data-filename="Image.png"/></span></span></div><div><span style="font-size: 11pt;"><span style="font-size: 11pt; font-weight: bold;"><img src="类加载和字节码技术2_files/Image [31].png" type="image/png" data-filename="Image.png"/></span></span></div><div><span style="font-size: 11pt;"><span style="font-size: 11pt; font-weight: bold;"><img src="类加载和字节码技术2_files/Image [32].png" type="image/png" data-filename="Image.png"/></span></span></div><div><span style="font-size: 14.6667px;"><span style="font-size: 14.6667px; font-weight: bold;">调用静态方法时，先将对象入栈，紧接着就弹出，静态方法不需要对象去调用，调用invokestatic 调用静态方法。</span></span></div><div><span style="font-size: 14.6667px;"><br/></span></div><div><span style="font-size: 14.6667px;"><br/></span></div><div><span style="font-size: 12pt; font-weight: bold;">2、10 多态的原理</span></div><div><span style="font-size: 11pt;"><span style="font-size: 11pt; font-weight: bold;"><img src="类加载和字节码技术2_files/Image [33].png" type="image/png" data-filename="Image.png"/></span></span></div><div><span style="font-size: 11pt;"><span style="font-size: 11pt; font-weight: bold;"><img src="类加载和字节码技术2_files/Image [34].png" type="image/png" data-filename="Image.png"/></span></span></div><div><span style="font-size: 14.6667px;"><span style="font-size: 14.6667px; font-weight: bold;">演示多态原理，注意加上下面的JVM参数，禁用指针压缩：</span></span></div><div><span style="font-size: 14.6667px;"><span style="font-size: 14.6667px; font-weight: bold;">    -XX:-UseCompressedOops -XX:-UseCompressedClassPointers</span></span></div><div><span style="font-size: 11pt;"><span style="font-size: 11pt; font-weight: bold;"><img src="类加载和字节码技术2_files/Image [35].png" type="image/png" data-filename="Image.png"/></span></span></div><div><span style="font-size: 14.6667px;"><span style="font-size: 14.6667px; font-weight: bold;">查找类：p26</span></span></div><div><span style="font-size: 14.6667px;"><br/></span></div><div><span style="font-size: 14.6667px;">多态的方法存在于vtable中</span></div><div><span style="font-size: 14.6667px;"><span style="font-size: 14.6667px; font-weight: bold;">vtable（虚方法表）</span></span></div><div><span style="font-size: 14.6667px;"><span style="font-size: 14.6667px; font-weight: bold;">vtable是在 类加载 过程中的链接阶段就会生成，</span></span></div><div><span style="font-size: 14.6667px; font-weight: bold;">vtable和class的偏移地址是1b8（十六进制）</span></div><div><span style="font-size: 11pt;"><span style="font-size: 11pt; font-weight: bold;"><img src="类加载和字节码技术2_files/Image [36].png" type="image/png" data-filename="Image.png"/></span></span></div><div><span style="font-weight: bold; font-size: 12pt;">2、11 异常处理</span></div><div><span style="font-size: 11pt;"><img src="类加载和字节码技术2_files/Image [37].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="font-size: 11pt;"><img src="类加载和字节码技术2_files/Image [38].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="font-size: 11pt;"><img src="类加载和字节码技术2_files/Image [39].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="font-size: 11pt;"><img src="类加载和字节码技术2_files/Image [40].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="font-size: 11pt;"><img src="类加载和字节码技术2_files/Image [41].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="font-size: 11pt;"><img src="类加载和字节码技术2_files/Image [42].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="font-size: 11pt;"><br/></span></div><div><span style="font-size: 11pt;"><br/></span></div><div><span style="font-size: 11pt;"><br/></span></div></span>
</div></body></html> 