<html>
<head>
  <title>Dubbo第三个案例（使用注册中心）</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/602916 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="5338"/>
<h1>Dubbo第三个案例（使用注册中心）</h1>

<div>
<span><div><span style="font-size: 12pt; font-weight: bold;">服务的提供者和之前相比：</span></div><div>    1、多了一个依赖</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>&lt;!--zookeeper注册中心依赖--&gt;</div><div>&lt;dependency&gt;</div><div>  &lt;groupId&gt;org.apache.curator&lt;/groupId&gt;</div><div>  &lt;artifactId&gt;curator-framework&lt;/artifactId&gt;</div><div>  &lt;version&gt;4.1.0&lt;/version&gt;</div><div>&lt;/dependency&gt;</div></div><div>   2、 多了一个标签</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>&lt;!--现在要使用zookeeper注册中心--&gt;</div><div>&lt;!--指定注册中心地址和端口号--&gt;</div><div>    &lt;dubbo:registry address=&quot;zookeeper://localhost:2181&quot;/&gt;</div></div><div>3、&lt;!--暴露服务接口--&gt;</div><div>&lt;dubbo:service interface=&quot;com.service.UserService&quot; ref=&quot;userService&quot; /&gt;少了一个属性registry，</div><div>4、需要去开启zookeeper服务</div><div><br/></div><div><font style="font-size: 12pt;"><span style="font-size: 12pt; font-weight: bold;">服务的消费者：</span></font></div><div>多了一个依赖：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>&lt;!--zookeeper注册中心依赖--&gt;</div><div>&lt;dependency&gt;</div><div>  &lt;groupId&gt;org.apache.curator&lt;/groupId&gt;</div><div>  &lt;artifactId&gt;curator-framework&lt;/artifactId&gt;</div><div>  &lt;version&gt;4.1.0&lt;/version&gt;</div><div>&lt;/dependency&gt;</div></div><div>dubbo-zk-consumer.xml</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</div><div>&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;</div><div>       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns:dubbo=&quot;http://dubbo.apache.org/schema/dubbo&quot;</div><div>       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://dubbo.apache.org/schema/dubbo http://dubbo.apache.org/schema/dubbo/dubbo.xsd&quot;&gt;</div><div>&lt;!--声明dubbo服务消费者名称：保证唯一性--&gt;</div><div>    &lt;dubbo:application name=&quot;dubbo-zk-consumer&quot;/&gt;</div><div>&lt;!--指定注册中心--&gt;</div><div>    &lt;dubbo:registry address=&quot;zook://localhost:2181&quot;/&gt;</div><div>&lt;!--引用远程接口服务--&gt;</div><div>    &lt;dubbo:reference id=&quot;userService&quot; interface=&quot;com.service.UserService&quot;/&gt;</div><div>&lt;/beans&gt;</div></div><div><br/></div><div><span style="font-size: 12pt; font-weight: bold;">在配置完成之后：</span></div><div>    需要先去启动zookeeper服务，再去启动服务的提供者，最后启动服务的消费者。</div><div><br/></div><div>出现问题：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>27-Jul-2021 16:07:02.090 淇℃伅 [RMI TCP Connection(2)-127.0.0.1] org.apache.catalina.core.ApplicationContext.log No Spring WebApplicationInitializer types detected on classpath</div><div>27-Jul-2021 16:07:02.303 淇℃伅 [RMI TCP Connection(2)-127.0.0.1] org.apache.catalina.core.ApplicationContext.log Initializing Spring root WebApplicationContext</div><div>27-Jul-2021 16:07:15.499 涓ラ噸 [RMI TCP Connection(2)-127.0.0.1] org.apache.catalina.core.StandardContext.listenerStart 寮傚父灏嗕笂涓嬫枃鍒濆鍖栦簨浠跺彂閫佸埌绫荤殑渚﹀惉鍣ㄥ疄渚�.[org.springframework.web.context.ContextLoaderListener]</div><div>    java.lang.NoClassDefFoundError: org/apache/curator/framework/recipes/cache/TreeCacheListener</div><div>        at java.lang.ClassLoader.defineClass1(Native Method)</div><div>        at java.lang.ClassLoader.defineClass(ClassLoader.java:763)</div><div>        at java.security.SecureClassLoader.defineClass(SecureClassLoader.java:142)</div><div>        at org.apache.catalina.loader.WebappClassLoaderBase.findClassInternal(WebappClassLoaderBase.java:2419)</div><div>        at org.apache.catalina.loader.WebappClassLoaderBase.findClass(WebappClassLoaderBase.java:865)</div><div>        at org.apache.catalina.loader.WebappClassLoaderBase.loadClass(WebappClassLoaderBase.java:1334)</div><div>        at org.apache.catalina.loader.WebappClassLoaderBase.loadClass(WebappClassLoaderBase.java:1188)</div><div>        at org.apache.dubbo.remoting.zookeeper.curator.CuratorZookeeperClient.createTargetDataListener(CuratorZookeeperClient.java:220)</div><div>        at org.apache.dubbo.remoting.zookeeper.curator.CuratorZookeeperClient.createTargetDataListener(CuratorZookeeperClient.java:52)</div><div>        at org.apache.dubbo.remoting.zookeeper.support.AbstractZookeeperClient.lambda$addDataListener$3(AbstractZookeeperClient.java:123)</div><div>        at java.util.concurrent.ConcurrentHashMap.computeIfAbsent(ConcurrentHashMap.java:1660)</div><div>        at org.apache.dubbo.remoting.zookeeper.support.AbstractZookeeperClient.addDataListener(AbstractZookeeperClient.java:123)</div><div>        at org.apache.dubbo.configcenter.support.zookeeper.ZookeeperDynamicConfiguration.&lt;init&gt;(ZookeeperDynamicConfiguration.java:57)</div><div>        at org.apache.dubbo.configcenter.support.zookeeper.ZookeeperDynamicConfigurationFactory.createDynamicConfiguration(ZookeeperDynamicConfigurationFactory.java:37)</div><div>        at org.apache.dubbo.common.config.configcenter.AbstractDynamicConfigurationFactory.lambda$getDynamicConfiguration$0(AbstractDynamicConfigurationFactory.java:39)</div><div>        at java.util.concurrent.ConcurrentHashMap.computeIfAbsent(ConcurrentHashMap.java:1660)</div><div>        at org.apache.dubbo.common.config.configcenter.AbstractDynamicConfigurationFactory.getDynamicConfiguration(AbstractDynamicConfigurationFactory.java:39)</div><div>        at org.apache.dubbo.common.config.configcenter.DynamicConfiguration.getDynamicConfiguration(DynamicConfiguration.java:224)</div><div>        at org.apache.dubbo.config.bootstrap.DubboBootstrap.prepareEnvironment(DubboBootstrap.java:1034)</div><div>        at org.apache.dubbo.config.bootstrap.DubboBootstrap.startConfigCenter(DubboBootstrap.java:623)</div><div>        at org.apache.dubbo.config.bootstrap.DubboBootstrap.initialize(DubboBootstrap.java:521)</div><div>        at org.apache.dubbo.config.bootstrap.DubboBootstrap.start(DubboBootstrap.java:896)</div><div>        at org.apache.dubbo.config.spring.context.DubboBootstrapApplicationListener.onContextRefreshedEvent(DubboBootstrapApplicationListener.java:59)</div><div>        at org.apache.dubbo.config.spring.context.DubboBootstrapApplicationListener.onApplicationContextEvent(DubboBootstrapApplicationListener.java:52)</div><div>        at org.apache.dubbo.config.spring.context.OneTimeExecutionApplicationContextEventListener.onApplicationEvent(OneTimeExecutionApplicationContextEventListener.java:40)</div><div>        at org.springframework.context.event.SimpleApplicationEventMulticaster.doInvokeListener(SimpleApplicationEventMulticaster.java:172)</div><div>        at org.springframework.context.event.SimpleApplicationEventMulticaster.invokeListener(SimpleApplicationEventMulticaster.java:165)</div><div>        at org.springframework.context.event.SimpleApplicationEventMulticaster.multicastEvent(SimpleApplicationEventMulticaster.java:139)</div><div>        at org.springframework.context.support.AbstractApplicationContext.publishEvent(AbstractApplicationContext.java:393)</div><div>        at org.springframework.context.support.AbstractApplicationContext.publishEvent(AbstractApplicationContext.java:347)</div><div>        at org.springframework.context.support.AbstractApplicationContext.finishRefresh(AbstractApplicationContext.java:883)</div><div>        at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:546)</div><div>        at org.springframework.web.context.ContextLoader.configureAndRefreshWebApplicationContext(ContextLoader.java:443)</div><div>        at org.springframework.web.context.ContextLoader.initWebApplicationContext(ContextLoader.java:325)</div><div>        at org.springframework.web.context.ContextLoaderListener.contextInitialized(ContextLoaderListener.java:107)</div><div>        at org.apache.catalina.core.StandardContext.listenerStart(StandardContext.java:4685)</div><div>        at org.apache.catalina.core.StandardContext.startInternal(StandardContext.java:5146)</div><div>        at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:183)</div><div>        at org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:717)</div><div>        at org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:690)</div><div>        at org.apache.catalina.core.StandardHost.addChild(StandardHost.java:705)</div><div>        at org.apache.catalina.startup.HostConfig.manageApp(HostConfig.java:1728)</div><div>        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)</div><div>        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)</div><div>        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)</div><div>        at java.lang.reflect.Method.invoke(Method.java:498)</div><div>        at org.apache.tomcat.util.modeler.BaseModelMBean.invoke(BaseModelMBean.java:289)</div><div>        at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.invoke(DefaultMBeanServerInterceptor.java:819)</div><div>        at com.sun.jmx.mbeanserver.JmxMBeanServer.invoke(JmxMBeanServer.java:801)</div><div>        at org.apache.catalina.mbeans.MBeanFactory.createStandardContext(MBeanFactory.java:456)</div><div>        at org.apache.catalina.mbeans.MBeanFactory.createStandardContext(MBeanFactory.java:405)</div><div>        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)</div><div>        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)</div><div>        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)</div><div>        at java.lang.reflect.Method.invoke(Method.java:498)</div><div>        at org.apache.tomcat.util.modeler.BaseModelMBean.invoke(BaseModelMBean.java:289)</div><div>        at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.invoke(DefaultMBeanServerInterceptor.java:819)</div><div>        at com.sun.jmx.mbeanserver.JmxMBeanServer.invoke(JmxMBeanServer.java:801)</div><div>        at com.sun.jmx.remote.security.MBeanServerAccessController.invoke(MBeanServerAccessController.java:468)</div><div>        at javax.management.remote.rmi.RMIConnectionImpl.doOperation(RMIConnectionImpl.java:1468)</div><div>        at javax.management.remote.rmi.RMIConnectionImpl.access$300(RMIConnectionImpl.java:76)</div><div>        at javax.management.remote.rmi.RMIConnectionImpl$PrivilegedOperation.run(RMIConnectionImpl.java:1309)</div><div>        at java.security.AccessController.doPrivileged(Native Method)</div><div>        at javax.management.remote.rmi.RMIConnectionImpl.doPrivilegedOperation(RMIConnectionImpl.java:1408)</div><div>        at javax.management.remote.rmi.RMIConnectionImpl.invoke(RMIConnectionImpl.java:829)</div><div>        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)</div><div>        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)</div><div>        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)</div><div>        at java.lang.reflect.Method.invoke(Method.java:498)</div><div>        at sun.rmi.server.UnicastServerRef.dispatch(UnicastServerRef.java:357)</div><div>        at sun.rmi.transport.Transport$1.run(Transport.java:200)</div><div>        at sun.rmi.transport.Transport$1.run(Transport.java:197)</div><div>        at java.security.AccessController.doPrivileged(Native Method)</div><div>        at sun.rmi.transport.Transport.serviceCall(Transport.java:196)</div><div>        at sun.rmi.transport.tcp.TCPTransport.handleMessages(TCPTransport.java:568)</div><div>        at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run0(TCPTransport.java:826)</div><div>        at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.lambda$run$0(TCPTransport.java:683)</div><div>        at java.security.AccessController.doPrivileged(Native Method)</div><div>        at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run(TCPTransport.java:682)</div><div>        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)</div><div>        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)</div><div>        at java.lang.Thread.run(Thread.java:748)</div><div>    Caused by: java.lang.ClassNotFoundException: org.apache.curator.framework.recipes.cache.TreeCacheListener</div><div>        at org.apache.catalina.loader.WebappClassLoaderBase.loadClass(WebappClassLoaderBase.java:1365)</div><div>        at org.apache.catalina.loader.WebappClassLoaderBase.loadClass(WebappClassLoaderBase.java:1188)</div><div>        ... 82 more</div><div>27-Jul-2021 16:07:15.577 淇℃伅 [RMI TCP Connection(2)-127.0.0.1] org.apache.catalina.core.ApplicationContext.log Closing Spring root WebApplicationContext</div><div><br/></div><div><br/></div></div><div>增加依赖（问题解决了）：</div><div>&lt;dependency&gt;</div><div>    &lt;groupId&gt;org.apache.curator&lt;/groupId&gt;</div><div>    &lt;artifactId&gt;curator-recipes&lt;/artifactId&gt;</div><div>    &lt;version&gt;4.1.0&lt;/version&gt;</div><div>&lt;/dependency&gt;</div><div><br/></div><div><br/></div></span>
</div></body></html> 