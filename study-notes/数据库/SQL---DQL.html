<html>
<head>
  <title>SQL---DQL</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/602916 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1726"/>
<h1>SQL---DQL</h1>

<div>
<span><div><div><div>DQL</div><hr/><div><span style="color: rgb(227, 0, 0); font-weight: bold;">一、简单查询：</span></div><div><span style="font-weight: bold;">1、语法格式</span>：<span style="color: rgb(255, 0, 0);">select 字段名1，字段名2，字段名3，...from表名；</span></div><div><span style="font-weight: bold;">2、给查询结果的列重命名</span></div><div>          <span style="color: rgb(255, 0, 0);">  select 字段名1，字段名2 as 重命名后的名字from emp；</span>（关键字as可以省略）</div><div><span style="font-weight: bold;">3、查询所有字段</span></div><div>            select*from 表名;(效率低，开发不建议使用，私下可以用)</div><div><span style="color: rgb(227, 0, 0); font-weight: bold;">二、条件查询：</span></div><div><span style="font-weight: bold;">语法格式：</span></div><div><span style="color: rgb(227, 0, 0);">    select  字段名，字段名...from 表名 where 条件;</span></div><div><span style="color: rgb(227, 0, 0);">执行顺序 先from 再where，最后select。</span></div><div><span style="color: rgb(227, 0, 0);"><img src="SQL---DQL_files/Image.png" type="image/png" data-filename="Image.png" width="1006"/></span></div><div><br/></div><div><span style="color: rgb(45, 79, 201);"><img src="SQL---DQL_files/Image [1].png" type="image/png" data-filename="Image.png" width="410"/></span></div><div><span style="color: rgb(45, 79, 201);">案例： </span> <span style="color: rgb(255, 0, 0);">between...and...（闭区间）</span></div><div><span style="color: rgb(45, 79, 201);">    找出工资在1100和3000之间的员工，包括1100和3000</span></div><div><span style="color: rgb(45, 79, 201);">select ename，sal from emp where sal between 1100and3000;</span></div><div>  between...and...还可以应用在字符串方面（左闭右开）</div><div>字符串第一个字母参与运算。</div><div><br/></div><div><br/></div><div>and和or的优先级问题：and的优先级较高</div><div>案例：</div><div>    找出薪资大于1000的并且部门编号是20或者30的员工</div><div>错误代码：</div><div>        select ename，sal，deptno from emp where sal&gt;1000and deptno =20or deptno=30;(因为and的优先级较高，会将sal&gt;1000and deptno=20先执行，和要求不符) </div><div>     修改为：  </div><div>         select ename，sal，deptno from emp where sal&gt;1000and (deptno =20or deptno=30);</div><div><br/></div><div><span style="color: rgb(255, 0, 0); font-weight: bold;">关键字in</span></div><div>in等同于or：</div><div>案例：</div><div>    找出工作岗位是MANAGER和SALESMAN的员工</div><div>select ename ，job from emp where job=‘SALESMAN’or job=‘MANAGER’;。</div><div>等同于</div><div>select ename，job from emp where job in（‘SALESMAN’,'MANAGER'）;</div><div><br/></div><div><span style="font-weight: bold;">not in</span> ：不在选定值中的值。</div><div><br/></div><div><span style="color: rgb(227, 0, 0); font-weight: bold;">模糊查询like：</span></div><div><span style="font-weight: bold;">两个符号（%，_）</span></div><div><span style="font-weight: bold;">%代表任意多个字符，_代表任意一个字符</span></div><div><span style="font-weight: bold;">案例：</span></div><div><span style="font-weight: bold;">    找出名字里含有‘O’的员工</span></div><div><span style="font-weight: bold;">select ename from emp where like‘%O%’；</span></div><div><span style="font-weight: bold;">找出第二个字母是A的员工：</span></div><div><span style="font-weight: bold;">select ename from emp where ename like‘_A%’;</span></div><div><span style="font-weight: bold;">找出名字中含有_的员工：</span></div><div><span style="font-weight: bold;">select name from emp where name like‘%\_%’；</span></div><div><br/></div><div><span style="color: rgb(227, 0, 0); font-weight: bold;">排序（升序和降序）</span></div><div><span style="font-weight: bold;">    默认是升序，asc表示升序，desc表示降序。</span></div><div><span style="font-weight: bold;">案例 </span></div><div><span style="font-weight: bold;">    1、按照工资升序，找出员工名和薪资</span></div><div><span style="font-weight: bold;">select ename，sal from emp order by sal；</span></div><div><span style="font-weight: bold;">    2、按照工资的降序排列，当工资相同的时候再按照名字的升序排列</span></div><div><span style="font-weight: bold;">select ename,sal from emp order by sal desc,ename asc;</span></div><div><span style="font-weight: bold;">    3、找出工作岗位是SALESMAN的员工，并且要求按照薪资的降序排列</span></div><div><span style="font-weight: bold;">select ename，job，sal from emp where job=‘SALESMAN’ order by sal desc；（执行顺序 from--&gt;where--&gt;select--&gt;order ）</span></div><div><br/></div><div><span style="color: rgb(227, 0, 0); font-weight: bold;">分组函数/多行处理函数（所有的分组函数都是对“某一组”数据进行操作的）</span></div><div>最初是多行，运算完变成一行。</div><div>分组函数自动忽略null；</div><div>count 计数</div><div>sun 求和</div><div>avg 平均值</div><div>max 最大值</div><div>min 最小<span style="font-size: unset; color: unset; font-family: unset;">值</span></div><div><br/></div><div>count(*)和count(具体的某个字段)的区别</div><div>    count(*):不是统计某个字段中数据的个数，而是统计总记录条数（和某个字段无关）</div><div>    count(comm):表示统计comm字段中不为null的元素。</div><div><br/></div><div>案例</div><div>    找出工资总和</div><div>select sum(sal) from emp;</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>案例</div><div>找出工资高于平均工资的员工</div><div>select avg(sal) from emp;//平均工资</div><div>select ename,sal from emp where sal&gt;avg(sal); </div><div>报错</div><div><font face="Monaco">原因：SQL语句当中有一个语法规则，分组函数不可直接使用在where字句中。（因为group by在where执行之后执行，而分组函数在group by之后执行）</font></div><div><font face="Monaco"><br/></font></div><div><font face="Monaco">修改：</font></div><div><font face="Monaco">select ename，sal from emp where sal&gt;(select avg(sal)from emp);</font></div></div><div><br/></div><div><span style="color: rgb(227, 0, 0); font-weight: bold;">单行处理函数</span></div><div>运算多少行，得到多少行。</div><div><span style="font-size: unset; color: unset; font-family: unset;">计算每个员工的年薪</span></div><div>select ename,(sal+ifnull(comm,0))as yearsal from emp;</div><div><br/></div><div>ifnull()空处理函数</div><div>    ifnull(kenn)</div><div><br/></div><div><span style="color: rgb(227, 0, 0); font-weight: bold;">group by和having</span></div><div>group by：按照某个字段或者某些字段进行分组。</div><div>having：having是对分组之后的数据进行再次过滤。</div><div><br/></div><div>案例：找出每个工作岗位的最高薪资</div><div>select max(sal)from emp group by job;</div><div><br/></div><div><span style="font-weight: bold;">注意：分组函数一般都会和group by联合使用，因而被叫作分组函数。并且任何一个分组函数都是在group by执行结束后才会执行的。 当没有group by的话，整张表自成一组。</span></div><div><br/></div><div><span style="font-weight: bold;">注意：当一条语句中有group by的话，select后面只能跟分组函数和参与分组的字段。</span></div><div>案例：（多字段联合分组）</div><div>    找出每个部门不同工作岗位的最高薪资</div><div>select depton,job,max(sal) from emp group by deptno,job;</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font face="Monaco">注意：</font></div><div><font face="Monaco">    1、having不能单独使用，必须和group by连用。</font></div><div><font face="Monaco">    2、尽量使用where过滤，实在不行在使用having过滤。</font></div><div><font face="Monaco">找出每个部门的最高薪资，要求显示薪资大于2900的数据</font></div><div><font face="Monaco">一、select max(sal),deptno from emp group by deptno having max(sal)&gt;2900;//效率低</font></div><div><font style="font-family: Monaco;">二、select ,max(sal),deptno from emp</font> where sal&gt;2900 <font style="font-family: Monaco;">group by deptno ;</font></div></div><div><br/></div></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>总结</div><div>一个完整的DQL语句怎么写？</div><div>select</div><div>    ...</div><div>from</div><div>    ...</div><div>where</div><div>    ...</div><div>group by</div><div>        ...</div><div>having</div><div>        ...</div><div>order by</div><div>        ...</div></div><div><br/></div><div><span style="color: rgb(255, 0, 0); font-weight: bold;">查询结果集去重：</span></div><div>distinct  ( distinct只能出现在所有字段的最前面，表示后面所有的字段联合起来去除重复记录)</div><div>案例</div><div>    select distinct job from emp;</div><div>案例</div><div>        统计岗位的数量</div><div><div>    select count( distinct job )from emp;</div><div><br/></div><div><br/></div><div><br/></div><hr/><div><span style="font-size: 14pt; font-weight: bold;">连接查询</span></div><div>1、连接查询也叫多表查询。</div><div>2、连接查询的分类</div><div>    根据语法出现的年代可分为：SQS92，SQL99。</div><div>    根据表的连接方式划分：</div><div>        1、内连接</div><div>            1、等值连接</div><div>            2、非等值连接</div><div>            3、自连接</div><div>        2、外连接</div><div>            1、左外连接</div><div>            2、右外连接</div><div>        3、全连接</div><div><br/></div><div>笛卡尔积现象：当两张表进行连接查询的时候，没有任何条件限制，最终的查询结果是两张表记录条数的乘积。</div><div><br/></div><div><span style="font-weight: bold;">表的别名：</span></div><div>    select e.ename,d.dname from emp e,dept d;</div><div>表的别名有什么好处？</div><div>    1、执行效率高。</div><div>    2、可读性好。</div><div><br/></div><div><span style="font-weight: bold;">怎么避免笛卡尔积现象？</span></div><div>    <span style="color: rgb(255, 0, 0);">加条件进行过滤。</span></div><div>思考：避免了笛卡尔积现象，会减少记录的匹配次数吗？</div><div>    不会，次数并没有减少，只是显示的是有效的记录。</div><div>例如：</div><div>        select </div><div>            e.ename,d.dname</div><div>        from</div><div>            emp e,dept d</div><div>        where</div><div>            e.deptno=d.deptno;//SQL92</div><div><br/></div><div><span style="font-weight: bold;">内连接之等值线接：条件是等量关系</span></div><div>案例：查询每个员工的部门名称，要求显示部门名和员工名。</div><div>SQL92：（过时）</div><div>        select</div><div>            e.ename,d.dname</div><div>        from</div><div>            emp e,dept d</div><div>        where</div><div>            e.deptno=d.deptno;</div><div>SQL99:(常用)</div><div>          select</div><div>            e.ename,d.dname</div><div>          from</div><div>            emp e</div><div>          join</div><div>            dept d</div><div>          on</div><div>            e.deptno=d.deptno;</div><div>语法：</div><div>        </div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>select</div><div>...</div><div>from</div><div>...A</div><div>inner join</div><div>...B</div><div>on</div><div>连接条件</div><div>where</div><div>...</div><div>inner可以省略，带着inner目的是可读性好，区分内连接和外连接。</div></div><div>SQL99语法结构更清晰，将连接条件和过滤条件分离开。</div><div><br/></div><div><span style="font-size: unset; color: unset; font-family: unset; font-weight: bold;">内连接之非等值连接：条件是非等量关系</span></div><div><span style="font-weight: bold;">案例</span></div><div><span style="font-weight: bold;">    select </span></div><div><span style="font-weight: bold;">        e.ename,e.sal,s.grade</span></div><div><span style="font-weight: bold;">    from</span></div><div><span style="font-weight: bold;">        emp e</span></div><div><span style="font-weight: bold;">    join</span></div><div><span style="font-weight: bold;">        salgrade s    </span></div><div><span style="font-weight: bold;">     on</span></div><div><span style="font-weight: bold;">        e.sal between s.losal and  s.hisal;</span></div><div><br/></div><div><br/></div><div><span style="font-weight: bold;">内连接之自连接：</span></div><div>一张表，自己连接自己。</div><div><br/></div><div><br/></div><div><span style="font-weight: bold;">外连接</span></div><div><span style="font-weight: bold;">外连接和内连接的区别</span></div><div><span style="font-weight: bold;">   内连接： 假设表A和B进行连接，使用内连接 的话，凡是A表和B表能够匹配上的记录查询出来，匹配不上的忽略，这就是内连接。AB两张表没有主副之分。</span></div><div><span style="font-weight: bold;">   外连接：  表A和表B进行连接，使用外连接的话，AB两表中有一张是主表，有一张是副表，主要查询主表中的数据，捎带查询副表，当副表中的数据没有和主表匹配上，副表自动模拟出NULL与之匹配。</span></div><div><br/></div><div><span style="font-weight: bold;">外连接之左外连接： 表示左表为主表。</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>select</div><div>    a.ename as'员工',b.ename'领导'</div><div>from</div><div>    emp a</div><div>left outer join </div><div>    emp b</div><div>on</div><div>    a.mgr=b.empno;</div></div><div><span style="font-weight: bold;">外连接之右外连接：表示右表为主表。</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>select</div><div>    a.ename as'员工',b.ename'领导'</div><div>from</div><div>    emp b</div><div>right outer join</div><div>    emp a</div><div>on</div><div>    a.mgr=b.empno;</div><div>//outer表示外连接，可以省略。</div></div><div><span style="font-weight: bold;">左连接有右连接的写法，右连接也会有相应的左连接的写法。</span></div><div><br/></div><div><img src="SQL---DQL_files/Image [2].png" type="image/png" data-filename="Image.png"/></div><div><img src="SQL---DQL_files/Image [3].png" type="image/png" data-filename="Image.png"/></div><div><span style="font-weight: bold;">全连接：</span></div><div><br/></div><div><span style="font-weight: bold;">三张表查询：</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><b>select</b></div><div><b>    e.ename,d.dname,s.grade</b></div><div><b>from</b></div><div><b>    emp e</b></div><div><b>join </b></div><div><b>    dept d</b></div><div><b>on</b></div><div><b>    e.deptno=d.deptno</b></div><div><b>join </b></div><div><b>    salgrade s</b></div><div><b>on</b></div><div><b>    e.sal between s.losal and s.hisal;</b></div></div><div><br/></div><div><br/></div><div><span style="font-weight: bold;">子查询：</span></div><div>select语句中嵌套select，被嵌套的select是子查询。</div><div>子查询可以出现在哪里？</div><div>    select</div><div>        ...(select)</div><div>    from</div><div>        ...(select)</div><div>    where</div><div>        ...(select) </div><div>    from中嵌套select可以将select产生的新表作为基表查询。</div><div>    where中嵌套select可以解决where中不能使用分组函数的问题。</div><div><br/></div><div><span style="font-weight: bold;">union（可以将查询结果集相加）</span></div><div><span style="font-weight: bold;">查询结果集列数要相同 </span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>找出工作岗位是SALESMAN和MANAGER的员工</div><div>第一种：select ename,job from emp where job='MANAGER'or job='SALESMAN';</div><div>第二种：select ename,job from emp where job in('MANAGER','SALESMAN');</div><div>第三种：union</div><div>select ename,job from emp where job='MANAGER'</div><div>union</div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">select ename,job from emp where job='SALESMAN';</span></div></div><div><br/></div><div><br/></div><div><br/></div><div>limit（mysql特有）</div><div>1、作用：取结果集中的部分数据。</div></div><div>2、Oracle中有一个相同的机制，叫做rownum。</div><div>3、语法机制：limit startIndex，length</div><div>        startIndex表示起始位置，length表示取几个。</div><div><br/></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>取工资前5名的员工</div><div>select ename,sal from emp order by sal desc limit 0,5;</div><div>select ename,sal from emp order by sal desc limit 5;</div><div><br/></div></div><div><br/></div><div>limit是sql语句最后进行的环节。</div><div><div><img src="SQL---DQL_files/Image [4].png" type="image/png" data-filename="Image.png"/></div><hr/><div><br/></div><div>DDL（数据定义语句）</div><div>DDL用于创建数据库对象，如表，视图，索引。</div><div>DML（数据操作语句）</div><div>DML语句用来检索和修改数据库的内容</div><div>常用编程语句：</div><div>        1.IF...ELSE</div><div><img src="SQL---DQL_files/Image [5].png" type="image/png" data-filename="Image.png" width="1655"/></div><div>        2.BEGIN...END</div><div><img src="SQL---DQL_files/Image [6].png" type="image/png" data-filename="Image.png" width="1608"/></div><div>        3.WHILE</div><div><img src="SQL---DQL_files/Image [7].png" type="image/png" data-filename="Image.png" width="1569"/></div><div>        4.GOTO语句和标签</div><div><img src="SQL---DQL_files/Image [8].png" type="image/png" data-filename="Image.png" width="1557"/></div><div>        5.WAITFOR语句（延迟后面的语句执行）</div><div><img src="SQL---DQL_files/Image [9].png" type="image/png" data-filename="Image.png" width="1579"/></div><div><br/></div><div><br/></div><div><br/></div></div><hr/><div><br/></div></div><div><br/></div></span>
</div></body></html> 