<html>
<head>
  <title>HTTPClient</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/602916 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="2956"/>
<h1>HTTPClient</h1>

<div>
<span><div>java的Http协议库，变为了HttpComponents </div><div><br/></div><div><br/></div><div>不带参数的Get请求</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>{</div><div><span>    //创建HttpClient对象，相当于浏览器。</span><br/></div><div><span><span>    //创建HttpGet对象，相当于输入请求地址</span><br/></span></div><div><span><span>    //使用HttpClient发起请求，相当于浏览器按回车，返回response</span><br/></span></div><div><span><span>    //状态码为200表示正常请求</span><br/></span></div><div><span><span>    //获取内容</span><br/></span></div><div><span><span>    //关闭response连接</span><br/></span></div><div><span><span>    //关闭HttpClient</span><br/></span></div><div><br/></div><div>}</div><div><br/></div><div><br/></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">{</span></div><div>//创建HttpClient对象</div><div>    CloseableHttpClient httpClient= HttpClients.createDefault();</div><div>    //声明HttpGet请求对象</div><div>    HttpGet httpGet=new HttpGet(&quot;https://www.buick.com.cn/lacrosse/?utm_source=baidu&amp;utm_medium=pc&amp;utm_term=SP-BU2010007_HS-2020121376_int80_DE1VB2xG14_1&amp;utm_content=SGMMRK2020000347&amp;utm_campaign=lacrosse-baidu-pckeyword&amp;renqun_youhua=325762&amp;bd_vid=9621668866877977799&amp;mz_ca=2215782&amp;mz_sp=7mp9I#kv&quot;);</div><div>    //使用HttpClient发起请求，获取response</div><div>    CloseableHttpResponse response= null;</div><div>    try {</div><div>        response = httpClient.execute(httpGet);</div><div>        //判断状态码是否为200</div><div>        if (response.getStatusLine().getStatusCode()==200) {</div><div>            //如果是200表示请求成功，获取响应的数据</div><div>            String html=EntityUtils.toString(response.getEntity(),&quot;UTF-8&quot;);</div><div>            System.out.println(html);</div><div><br/></div><div><br/></div><div>        }</div><div>    } catch (IOException e) {</div><div>        e.printStackTrace();</div><div>    }finally {</div><div>        if(response!=null){</div><div>            try {</div><div>                response.close();</div><div>            } catch (IOException e) {</div><div>                e.printStackTrace();</div><div>            }</div><div>        }</div><div>        if(httpClient!=null){</div><div>            try {</div><div>                httpClient.close();</div><div>            } catch (IOException e) {</div><div>                e.printStackTrace();</div><div>            }</div><div>        }</div><div>    }</div><div><br/></div><div><br/></div><div>}</div></div><div><br/></div><div>带参数的Get请求</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>{</div><div>//创建HttpClient对象</div><div>    CloseableHttpClient httpClient= HttpClients.createDefault();</div><div>    <span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">//创建URLBuilder设置参数,</span><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">.setparameter设置参数内容，返回值为URLBuilder，可以在后面继续设置参数<br/></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span>    URLBuild urlBuilder=new URLBuilder(&quot;</span>https://www.buick.com.cn/lacrosse</span><span><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">&quot;)setparameter(&quot;&quot;,&quot;&quot;).setparameter(&quot;&quot;,&quot;&quot;);</span><br/></span></div><div><span>    </span>//声明HttpGet请求对象</div><div>    HttpGet httpGet=new HttpGet(uriBuilder.build());</div><div>    //使用HttpClient发起请求，获取response</div><div>    CloseableHttpResponse response= null;</div><div>    try {</div><div>        response = httpClient.execute(httpGet);</div><div>        //判断状态码是否为200</div><div>        if (response.getStatusLine().getStatusCode()==200) {</div><div>            //如果是200表示请求成功，获取响应的数据</div><div>            String html=EntityUtils.toString(response.getEntity(),&quot;UTF-8&quot;);</div><div>            System.out.println(html);</div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div>        }</div><div>    } catch (IOException e) {</div><div>        e.printStackTrace();</div><div>    }finally {</div><div>        if(response!=null){</div><div>            try {</div><div>                response.close();</div><div>            } catch (IOException e) {</div><div>                e.printStackTrace();</div><div>            }</div><div>        }</div><div>        if(httpClient!=null){</div><div>            try {</div><div>                httpClient.close();</div><div>            } catch (IOException e) {</div><div>                e.printStackTrace();</div><div>            }</div><div>        }</div><div>    }</div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div>}</div></div><div><br/></div><div>不带参数的Post请求</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>{</div><div>    //创建HttpClient对象，相当于浏览器。</div><div>    //创建HttpPost对象，相当于输入请求地址</div><div>    //使用HttpClient发起请求，相当于浏览器按回车，返回response</div><div>    //状态码为200表示正常请求</div><div>    //获取内容</div><div>    //关闭response连接</div><div>    //关闭HttpClient</div><div><br/></div><div><br/></div><div>}</div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div>{</div><div>//创建HttpClient对象</div><div>    CloseableHttpClient httpClient= HttpClients.createDefault();</div><div>    //声明HttpGet请求对象</div><div>    HttpGet httpPost=new HttpPost(&quot;https://www.buick.com.cn/lacrosse/?utm_source=baidu&amp;utm_medium=pc&amp;utm_term=SP-BU2010007_HS-2020121376_int80_DE1VB2xG14_1&amp;utm_content=SGMMRK2020000347&amp;utm_campaign=lacrosse-baidu-pckeyword&amp;renqun_youhua=325762&amp;bd_vid=9621668866877977799&amp;mz_ca=2215782&amp;mz_sp=7mp9I#kv&quot;);</div><div>    //使用HttpClient发起请求，获取response</div><div>    CloseableHttpResponse response= null;</div><div>    try {</div><div>        response = httpClient.execute(httpPost);</div><div>        //判断状态码是否为200</div><div>        if (response.getStatusLine().getStatusCode()==200) {</div><div>            //如果是200表示请求成功，获取响应的数据</div><div>            String html=EntityUtils.toString(response.getEntity(),&quot;UTF-8&quot;);</div><div>            System.out.println(html);</div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div>        }</div><div>    } catch (IOException e) {</div><div>        e.printStackTrace();</div><div>    }finally {</div><div>        if(response!=null){</div><div>            try {</div><div>                response.close();</div><div>            } catch (IOException e) {</div><div>                e.printStackTrace();</div><div>            }</div><div>        }</div><div>        if(httpClient!=null){</div><div>            try {</div><div>                httpClient.close();</div><div>            } catch (IOException e) {</div><div>                e.printStackTrace();</div><div>            }</div><div>        }</div><div>    }</div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div>}</div></div><div>带参数的Post请求</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>设置表单数据</div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">//创建List集合封装请求参数</span></div><div><font face="Monaco">List&lt;NameValuePair&gt; params= new ArrayList&lt;NameValuePair&gt;();</font></div><div><font style="font-family: Monaco;">params.add(new BasicNameValuePair(&quot;scope&quot;,&quot;project&quot;));</font></div><div>params.add(new BasicNameValuePair(&quot;q&quot;,&quot;HttpClient&quot;));</div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">//使用封装请求参数的List集合，创建表单实体对象</span></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">UrlEncodedFormEntity formEntity=new UrlEncodedFormEntity(params,&quot;UTF-8&quot;);</span></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">//把表单实体设置到请求httpPost中</span></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">httpPost.seten(formEntity);</span></div></div><div><br/></div><div><br/></div><div>反爬虫，通过 User-Agent</div><div>人为访问，会存在User-Agent信息，而爬虫没有这些信息，故会被识别出来。</div><div>解决方案：在请求头加入User-Agent信息</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>httpGet.setHeader(&quot;User-Agent&quot;,&quot;&quot;);</div></div><div><br/></div><div><br/></div><div><br/></div><div>连接池管理器(管理HttpClient对象)</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>{//创建连接池管理器</div><div>poolingHttpClientConnectionManager cm=new poolingHttpClientConnectionManager();</div><div>//设置最大连接数</div><div>cm.setMaxTotal(200);</div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">//设置每个主机的最大连接数，访问每一个网站指定的连接数，不会影响其他网站的访问</span></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">cm.setDefaultMaxPerRoute(20);</span></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">//使用连接池管理器获取连接并发起请求</span></div><div>get(cm);</div><div>}</div><div><br/></div><div>private static void get(poolingHttpClientConnectionManager cm){</div><div><span>    //使用连接池管理器获取连接</span><br/></div><div><span><span>    CloseableHttpClient httpClient=HttpClients.custor().setConnectionManager(cm).build();</span><br/></span></div><div><br/></div><div>}</div></div><div>请求参数</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">//构建请求配置信息</span></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">//</span>setConnectTimeout(1000),创建连接最长时间</div><div>//setConnectionRequestTimeout(500),从连接池中获取到连接的最长时间</div><div>//setSocketTimeout(10*1000)，数据传输的最长时间RequestConfig config=RequestConfig.custom().setConnectTimeout(1000).setConnectionRequestTimeout(500).setSocketTimeout(10*1000).build();</div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">//设置请求配置信息</span></div><div><font face="Monaco">httpGet.setConfig(config);</font></div></div><div><br/></div></span>
</div></body></html> 