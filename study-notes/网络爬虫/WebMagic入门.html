<html>
<head>
  <title>WebMagic入门</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/602916 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="3006"/>
<h1>WebMagic入门</h1>

<div>
<span><div>创建Maven工程，并加入依赖</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">&lt;!--</span>WebMagic核心包<span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">--&gt;</span></div><div>&lt;dependency&gt;</div><div>    &lt;groupId&gt;us.codecraft&lt;/groupId&gt;</div><div>    &lt;artifactId&gt;webmagic-core&lt;/artifactId&gt;</div><div>    &lt;version&gt;0.7.4&lt;/version&gt;</div><div>&lt;/dependency&gt;</div><div>&lt;1--WebMagic扩展包--&gt;</div><div>&lt;dependency&gt;</div><div>    &lt;groupId&gt;us.codecraft&lt;/groupId&gt;</div><div>    &lt;artifactId&gt;webmagic-extension&lt;/artifactId&gt;</div><div>    &lt;version&gt;0.7.4&lt;/version&gt;</div><div>&lt;/dependency&gt;</div></div><div>加入配置文件</div><div>WebMagic使用sif4j-log4j12作为sif4j的实现。</div><div>添加log4j.properties配置文件</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>log4j.rootLogger=INFo,A1</div><div><br/></div><div>log4j.appender.A1=org.apache.log4j.ConsoleAppender</div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">log4j.appened.A1.layout=org.apache.log4j.PatternLayout</span></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">log4j.appender.A1.layout.ConversionPattern=%-d{yyyy-MM-dd HH:mm:ss,SSS} {%t} {%c}-{%p} %m%n</span></div></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">第一个简单案例</span></div><div>创建JobProcessor类实现PageProcessor接口</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>public class JobProcessor implements PageProcessor{</div><div>    private Site site=Site.me()</div><div>            .setCharset(&quot;utf-8&quot;) //设置编码    </div><div>            .setTimeOut(10000)        //设置超时时间，单位是ms</div><div>            .setRetrySleepTime(3000)       //设置重试的间隔时间</div><div>            .setSleepTime(3)            //设置重置次数    </div><div>            ;</div><div>    //解析页面</div><div>    public void process(Page page){</div><div>    //解析返回的数据Page，并把解析的结果放到ResultItems中            </div><div>    page.putField(&quot;div&quot;,getHtml().css(&quot;div.mt h2&quot;).all());</div><div>    }</div><div>    </div><div>    public Site getSite(){</div><div>        return site;</div><div>    }</div><div>    public static void main(String[] args){</div><div>        Spider.create(new JobProcessor())</div><div>                .addUrl(&quot;&quot;)//需要解析的地址</div><div>                .addPipeline(new FilePipeline(&quot;本地文件路径&quot;))</div><div>                .thread(5)//设置5个线程处理</div><div>                .setScheduler(new QueueScheduler().setDuplicateRemover(new BloomFilterDuplicateRemover(10000000)))//设置布隆去重过滤器，指定最多对1000万条数据进行去重操作</div><div>                .run();//执行爬虫</div><div>    }</div><div>}</div></div><div><br/></div><div>实现PageProcessor</div><div>        抽取元素Selectable</div><div>    WebMagic里主要使用了三种抽取技术：Xpath、正则表达式和CSS选择器。另外对于JSON格式的内容，可使用JsonPath进行解析。</div><div>    1、XPath</div><div>    以下是获取属性class=mt的div标签，里面的h1标签的内容</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>page.getHtml().xpath(&quot;//div[@class=mt]/h1/text()&quot;)</div></div><div>    </div><div>    2、CSS选择器</div><div><br/></div><div>    3、正则表达式</div><div>        正则表达式是一种通用的文本抽取语言。</div><div><br/></div><div>    4、链式抽取</div><div><img src="WebMagic入门_files/Image.png" type="image/png" data-filename="Image.png"/></div><div><img src="WebMagic入门_files/Image [1].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>获取链接</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>page.addTargetRequests(page.getHtml().css(div#news_div).links()regex(&quot;.*9$&quot;).all());</div><div>page.putField(&quot;url&quot;,page.getHtml().css(&quot;div.mt h1&quot;).all());</div></div><div><br/></div><div><br/></div><div>爬虫的配置、启动和终止</div><div>        Spider</div><div>    Spider是爬虫对象的入口。在启动爬虫之前，需要使用一个PageProcessor创建一个Spider对象，然后使用run()进行启动。</div><div>    <img src="WebMagic入门_files/Image [2].png" type="image/png" data-filename="Image.png"/></div><div><img src="WebMagic入门_files/Image [3].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div><br/></div><div>爬虫配置Site</div><div>    Site.me()可以对爬虫进行一些配置，包括编码、抓取间隔、超时时间、重试次数。</div><div><img src="WebMagic入门_files/Image [4].png" type="image/png" data-filename="Image.png"/></div><div><img src="WebMagic入门_files/Image [5].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>Scheduler组件</div><div> Scheduler是WebMagic中进行URL管理的组件。一般来说，Scheduler包括两个作用：</div><div>    1、对待抓取的URL队列进行管理。</div><div>    2、对已抓取的URL进行去重。</div><div><img src="WebMagic入门_files/Image [6].png" type="image/png" data-filename="Image.png"/></div><div><img src="WebMagic入门_files/Image [7].png" type="image/png" data-filename="Image.png"/></div><div><img src="WebMagic入门_files/Image [8].png" type="image/png" data-filename="Image.png"/></div><div>三种去重方式：</div><div>  <img src="WebMagic入门_files/Image [9].png" type="image/png" data-filename="Image.png"/></div><div><img src="WebMagic入门_files/Image [10].png" type="image/png" data-filename="Image.png"/></div><div><img src="WebMagic入门_files/Image [11].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div><br/></div><div><img src="WebMagic入门_files/Image [12].png" type="image/png" data-filename="Image.png"/></div><div><img src="WebMagic入门_files/Image [13].png" type="image/png" data-filename="Image.png"/></div><div><br/></div></span>
</div></body></html> 