<html>
<head>
  <title>SpringBoot数据源自动配置</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/602916 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="6322"/>
<h1>SpringBoot数据源自动配置</h1>

<div>
<span><div><div><span style="font-weight: bold; font-size: 14pt;">一、数据源自动管理</span></div><div><br/></div><div><span style="font-size: 12pt; font-weight: bold;">数据源（DataSource）：</span> <span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 11pt; color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-variant-caps: normal; font-variant-ligatures: normal;">SUN制定的用于获取数据库连接的规范接口，</span> <span style="font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-variant-caps: normal; font-variant-ligatures: normal;">它存在于 javax.sql包中，用来代替 DriverManager 的方式</span><span style="font-size: 16px; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun;">来获取连接。</span></div><div style="font-size: 12px;"><br/></div><div style="font-size: 12px;"><span style="font-size: 12px; font-weight: bold;"> </span><span style="font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">DataSource 与 DriverManager 获取连接的不同：</span></div><div><span style="font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-variant-caps: normal; font-variant-ligatures: normal;">    </span><span style="font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-variant-caps: normal; font-variant-ligatures: normal;">1、DriverManager是由SUN实现的，它只供了最基本的获取</span><span style="font-size: 16px; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun;">连接的方式。</span></div><div><span style="font-size: 16px; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun;">        注：</span><span style="font-size: 9pt; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun;">sun公司是java的开发公司，被oracle（甲骨文公司）收购，java现属于oracle公司。</span></div><div><span style="font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-variant-caps: normal; font-variant-ligatures: normal;">    </span><span style="font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-variant-caps: normal; font-variant-ligatures: normal;">2、 而DataSource是一个接口，不光SUN可以实现，很多第三方</span><span style="font-size: 16px; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun;">的中间件也可以实现，而且实现得很好。</span></div><div><br/></div><div style="font-size: 12px;"><span style="font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">DataSource一般有如下三种实现方式：</span></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;"> </span> <span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: Monaco;">  1、标准实现 -- 提供最基本的连接，也就是DriverManager的方式</span></div><div><span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: Monaco;">    2、连接池的实现 -- 提供了连接池，是一种可以缓存及管理多个</span><span style="font-size: 11pt;">数据库连接的“容器”。</span></div><div><span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: Monaco;">    3、分布事务的实现 -- 提供了连接池，而且这个池中的连接是</span><span style="font-size: 11pt;">支持分布式事务的(Distribute Transaction)</span></div><div><br/></div><div><span style="font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-variant-caps: normal; font-variant-ligatures: normal;">    </span><span style="font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-variant-caps: normal; font-variant-ligatures: normal;">  </span> <span style="font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-variant-caps: normal; font-variant-ligatures: normal;">一般来说，DataSource 都会由专业的中间件(MiddleWare)来实现。</span><span style="font-size: 16px; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun;">当然，也有一些开源(免费)的 DataSource的实现。</span><span style="font-size: 16px; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun;">最有名就是：Apache 组织提供的 commons-dbcp</span></div><div> </div><hr/><div><br/></div><div><br/></div><div>    引入JDBC依赖和springboot的应用场景</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>&lt;dependency&gt;</div><div>   &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div>   &lt;artifactId&gt;spring-boot-starter-jdbc&lt;/artifactId&gt;</div><div>&lt;/dependency&gt;</div><div>&lt;dependency&gt;</div><div>   &lt;groupId&gt;mysql&lt;/groupId&gt;</div><div>   &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</div><div>   &lt;scope&gt;runtime&lt;/scope&gt;</div><div>&lt;/dependency&gt;</div></div><div>    使用yaml方式配置，创建application.yaml</div><div>    在默认情况下，数据库连接可以使用DataSource池进行自动配置。</div><div><span style="font-size: 9pt;"><br/></span></div><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51); font-family: Monaco; font-size: 12px; font-weight: bold;">    默认 Hikari可用，Springboot将使用它。（这里的默认是在</span></span><span style="font-size: 9pt;"><span style="color: rgb(51, 51, 51); font-family: Monaco; font-size: 9pt; font-weight: bold;">spring-boot-starter-jdbc下默认引入的是Hikari的依赖，引入哪个依赖，springboot就会启用哪个数据源的</span></span><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco; font-weight: bold;">自动配置（SPI思想）</span><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51); font-family: Monaco; font-size: 12px; font-weight: bold;">）</span></span></div><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">    可以自己指定数据源配置，通过type来选取使用哪种数据源</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font style="font-family: Monaco; color: rgb(51, 51, 51);">spring:</font></div><div><font style="font-family: Monaco; color: rgb(51, 51, 51);">    datasource:</font></div><div><font style="font-family: Monaco; color: rgb(51, 51, 51);">        username: root</font></div><div><font style="font-family: Monaco; color: rgb(51, 51, 51);">        password: 2019936206</font></div><div><font style="font-family: Monaco; color: rgb(51, 51, 51);">        url: jdbc:mysql://localhost:3306/boot_deom</font></div><div><font style="font-family: Monaco; color: rgb(51, 51, 51);">        driver-class-name: com.mysql.cj.jdbc.Driver</font></div><div><font style="font-family: Monaco; color: rgb(51, 51, 51);">        type: com.zaxxer.hikari.HikariDataSource</font></div></div><div style="font-size: 12px;"><br/></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco; font-weight: bold; font-size: 14pt;">二、配置druid数据源</span></div><div><span style="font-size: 16px; color: rgb(51, 51, 51); font-family: Monaco;">    引入druid的依赖</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 16px;">&lt;dependency&gt;</span></div><div><span style="font-size: 16px;">   &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span></div><div><span style="font-size: 16px;">   &lt;artifactId&gt;druid&lt;/artifactId&gt;</span></div><div><span style="font-size: 16px;">   &lt;version&gt;1.1.12&lt;/version&gt;</span></div><div><span style="font-size: 16px;">&lt;/dependency&gt;</span></div><div><span style="font-size: 16px;">&lt;dependency&gt;</span></div><div><span style="font-size: 16px;">   &lt;groupId&gt;log4j&lt;/groupId&gt;</span></div><div><span style="font-size: 16px;">   &lt;artifactId&gt;log4j&lt;/artifactId&gt;</span></div><div><span style="font-size: 16px;">   &lt;version&gt;1.2.17&lt;/version&gt;</span></div><div><span style="font-size: 16px;">&lt;/dependency&gt;</span></div></div><div style="font-size: 12px;"><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>spring:</div><div>    datasource:</div><div>        username: root</div><div>        password: 2019936206</div><div>        url: jdbc:mysql://localhost:3306/boot_deom</div><div>        driver-class-name: com.mysql.cj.jdbc.Driver</div><div>        type: com.alibaba.druid.pool.DruidDataSource</div></div><div style="font-size: 12px;"><br/></div><div style="font-size: 12px;"><span style="font-size: 12px;">配置数据源连接池的属性</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>spring:</div><div>    datasource:</div><div>        username: root</div><div>        password: 2019936206</div><div>        url: jdbc:mysql://localhost:3306/boot_deom</div><div>        driver-class-name: com.mysql.cj.jdbc.Driver</div><div>        type: com.alibaba.druid.pool.DruidDataSource</div><div>        initialSize: 5</div><div>        minIdle: 5</div><div>        maxActive: 20</div><div>        maxWait: 60000</div><div>        timeBetweenEvictionRunsMillis: 60000</div><div>        minEvictableIdleTimeMillis: 300000</div><div>        validationQuery: SELECT 1 FROM DUAL</div><div>        testWhileIdle: true</div><div>        testOnBorrow: false</div><div>        testOnReturn: false</div><div>        poolPreparedStatements: true</div><div>        filters: stat,wall,log4j</div><div>        maxPoolbalDataSourceStat: true</div><div>        connectionProperties: druid.stat.mergeSql=true;druid.stat.slowSqlMillis=500</div><div><br/></div></div><div style="font-size: 12px;"><span style="font-size: 12px;">    创建数据源注册类：</span></div><div style="font-size: 12px;"><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;"><img src="SpringBoot数据源自动配置_files/Image.png" type="image/png" data-filename="Image.png"/></span></div><div style="font-size: 12px;"><br/></div><div style="font-size: 12px;"><br/></div><div style="font-size: 12px;"><br/></div><div style="font-size: 12px;"><br/></div><div style="font-size: 12px;"><br/></div><div style="font-size: 12px;"><br/></div></div></span>
</div></body></html> 