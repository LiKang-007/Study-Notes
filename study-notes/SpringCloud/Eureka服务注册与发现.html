<html>
<head>
  <title>Eureka服务注册与发现</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/602916 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="6438"/>
<h1>Eureka服务注册与发现</h1>

<div>
<span><div><div><span style="font-size: 12pt; font-weight: bold;">什么是 Eureka？</span></div><div>    Netflix在设计Eureka时，遵循的就是AP原则</div><div>    Eureka是Netflix的一个子模块，也是核心模块之一。Eureka是一个基于REST的服务，用于定位服务。以实现云端中间层服务发现和故障转移，服务注册与发现对于微服务来说是非常重要的，有了服务注册和发现，只需要使用服务的标识符，就可以访问到服务，而不需要修改服务调用的配置文件了，功能类似于Dubbo的注册中心，比如Zookeeper；</div><div><br/></div><div>基本原理：</div><div>    Eureka的基本架构</div><div><img src="Eureka服务注册与发现_files/Image.png" type="image/png" data-filename="Image.png"/></div><div><img src="Eureka服务注册与发现_files/Image [1].png" type="image/png" data-filename="Image.png"/></div><div>    三大角色</div><div><img src="Eureka服务注册与发现_files/Image [2].png" type="image/png" data-filename="Image.png"/></div><div>    三大角色对应三个依赖</div><div>    </div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>server：spring-cloud-starter-eureka-server</div><div>Provider：spring-cloud-starter-eureka</div><div>Consumer：</div></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>一般导入功能的步骤</div><div>    1、导入依赖</div><div>    2、编写配置文件</div><div>    3、开启这个功能 @EnableXXXXX</div><div>    4、配置类</div></div><div><br/></div><div><br/></div><div>1、新建Eureka-server项目，启动Eureka-server服务</div><div>    1、1导入依赖</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>&lt;dependencies&gt;</div><div>    &lt;!--eureka server--&gt;</div><div>    &lt;dependency&gt;</div><div>        &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</div><div>        &lt;artifactId&gt;spring-cloud-starter-eureka-server&lt;/artifactId&gt;</div><div>        &lt;version&gt;1.4.6.RELEASE&lt;/version&gt;</div><div>    &lt;/dependency&gt;</div><div>    &lt;!--热部署--&gt;</div><div>    &lt;dependency&gt;</div><div>        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div>        &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;</div><div>    &lt;/dependency&gt;</div><div>&lt;/dependencies&gt;</div></div><div>    1、2、添加配置</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>server:</div><div>  port: 7001</div><div><br/></div><div>#Eureak</div><div>eureka:</div><div>  instance:</div><div>    hostname: localhost #Eureka服务端的实例名称</div><div>  client:</div><div>    register-with-eureka: false #表示是否向eureka注册自己</div><div>    fetch-registry: false #false表示自己为注册中心</div><div>    service-url: #监控页面</div><div>      defaultZone:  http://${eureka.instance.hostname}:${server.port}/eureka</div></div><div>       1、3、配置启动类</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>package com.springcloud;</div><div><br/></div><div><br/></div><div>import org.springframework.boot.SpringApplication;</div><div>import org.springframework.boot.autoconfigure.SpringBootApplication;</div><div>import org.springframework.cloud.netflix.eureka.server.EnableEurekaServer;</div><div>/**</div><div>* @Auther:LiKang</div><div>* @Date:2021/8/23 -08 -23 -9:23</div><div>* @Description: com.springcloud</div><div>* @version: 1.0</div><div>*/</div><div>@SpringBootApplication</div><div>@EnableEurekaServer //@EnableEurekaServer 服务端的启动类，可以接受别人注册进来</div><div>public class EurekaServer_7001 {</div><div>    public static void main(String[] args) {</div><div>        SpringApplication.run(EurekaServer_7001.class,args);</div><div>    }</div><div>}</div></div><div>2、将服务提供者中的服务交给 Eureka-server。</div><div>    2、1、添加依赖</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>&lt;dependencies&gt;</div><div>    &lt;!--服务提供者eureka的依赖--&gt;</div><div>    &lt;dependency&gt;</div><div>        &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</div><div>        &lt;artifactId&gt;spring-cloud-starter-eureka&lt;/artifactId&gt;</div><div>        &lt;version&gt;1.4.6.RELEASE&lt;/version&gt;</div><div>    &lt;/dependency&gt;</div><div>    &lt;!--actuator 完善监控信息--&gt;</div><div>    &lt;dependency&gt;</div><div>        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div>        &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;</div><div>    &lt;/dependency&gt;</div><div><br/></div><div><br/></div><div>    &lt;!--需要拿到实体类，需要配置API module--&gt;</div><div>    &lt;dependency&gt;</div><div>        &lt;groupId&gt;org.example&lt;/groupId&gt;</div><div>        &lt;artifactId&gt;springcloud-api&lt;/artifactId&gt;</div><div>        &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</div><div>    &lt;/dependency&gt;</div><div>    &lt;!--junit--&gt;</div><div>    &lt;dependency&gt;</div><div>        &lt;groupId&gt;junit&lt;/groupId&gt;</div><div>        &lt;artifactId&gt;junit&lt;/artifactId&gt;</div><div>    &lt;/dependency&gt;</div><div>    &lt;dependency&gt;</div><div>        &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt;</div><div>        &lt;artifactId&gt;logback-core&lt;/artifactId&gt;</div><div>    &lt;/dependency&gt;</div><div>    &lt;dependency&gt;</div><div>        &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt;</div><div>        &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt;</div><div>    &lt;/dependency&gt;</div><div>    &lt;!--test--&gt;</div><div>    &lt;dependency&gt;</div><div>        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div>        &lt;artifactId&gt;spring-boot-test&lt;/artifactId&gt;</div><div>    &lt;/dependency&gt;</div><div>    &lt;dependency&gt;</div><div>        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div>        &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</div><div>    &lt;/dependency&gt;</div><div>    &lt;!--热部署--&gt;</div><div>    &lt;dependency&gt;</div><div>        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div>        &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;</div><div>    &lt;/dependency&gt;</div><div>&lt;/dependencies&gt;</div></div><div>    2、2、添加配置</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>server:</div><div>  port: 8001</div><div><br/></div><div><br/></div><div>#mybatis配置</div><div>mybatis:</div><div>  type-aliases-package: com.springcloud.pojo</div><div>  config-location:  classpath:mybatis/mybatis-config.xml</div><div>  mapper-locations: classpath:mybatis/mapper/*.xml</div><div>#spring配置</div><div>spring:</div><div>  application:</div><div>    name: springcloud-provider-dept</div><div>  datasource:</div><div>    type: com.alibaba.druid.pool.DruidDataSource #数据源</div><div>    driver-class-name: com.mysql.cj.jdbc.Driver</div><div>    url: jdbc:mysql://localhost:3306/db01?useUnicode=true&amp;characterEncoding=utf-8&amp;serverTimezone=GMT%2B8</div><div>    username: root</div><div>    password: 2019936206</div><div><br/></div><div><br/></div><div>#Eureka的配置，服务注册到哪里</div><div>eureka:</div><div>  client:</div><div>    service-url:</div><div>      defaultZone: http://localhost:7001/eureka/</div><div>  instance:</div><div>    instance-id: springcloud-provider-dept-8001 #修改eureak上的默认描述信息</div><div>#info配置（actuator 完善监控信息,告知需要调用该服务的信息）</div><div>info:</div><div>  app.name: lk</div><div>  company: qtz.com</div><div><br/></div><div><br/></div></div><div>    2、3、配置启动类</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>package com.springcloud;</div><div><br/></div><div><br/></div><div>import org.springframework.boot.SpringApplication;</div><div>import org.springframework.boot.autoconfigure.SpringBootApplication;</div><div>import org.springframework.cloud.netflix.eureka.EnableEurekaClient;</div><div><br/></div><div><br/></div><div>/**</div><div>* @Auther:LiKang</div><div>* @Date:2021/8/22 -08 -22 -15:19</div><div>* @Description: com.springcloud</div><div>* @version: 1.0</div><div>*/</div><div>//启动类</div><div>@EnableEurekaClient //在服务启动后自动注册到Eureka server中</div><div>@SpringBootApplication</div><div>public class DeptProvider_8001 {</div><div>    public static void main(String[] args) {</div><div>        SpringApplication.run(DeptProvider_8001.class,args);</div><div>    }</div><div>}</div></div><div><br/></div><div>3、服务消费者去 Eureka-server 获取服务。</div><div><br/></div><div>Eureka服务注册-信息配置-自我保护机制</div><div>    </div><div>Eureka的自我保护机制：</div><div><img src="Eureka服务注册与发现_files/Image [3].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div><span style="font-weight: bold;">Eureka集群环境配置：</span></div><div><img src="Eureka服务注册与发现_files/Image [4].png" type="image/png" data-filename="Image.png"/></div><div>修改hosts里的内容：（映射）</div><div><img src="Eureka服务注册与发现_files/Image [5].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>server:</div><div>  port: 7001</div><div><br/></div><div><br/></div><div>#Eureak</div><div>eureka:</div><div>  instance:</div><div>    hostname: localhost #Eureka服务端的实例名称</div><div>  client:</div><div>    register-with-eureka: false #表示是否向eureka注册自己</div><div>    fetch-registry: false #false表示自己为注册中心</div><div>    service-url: #监控页面</div><div>      #单机defaultZone:  http://${eureka.instance.hostname}:${server.port}/eureka</div><div>      #集群：关联</div><div>      defaultZone: http://localhost:7002/eureka/,http://localhost:7003/eureka/</div></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>server:</div><div>  port: 7002</div><div><br/></div><div><br/></div><div>#Eureak</div><div>eureka:</div><div>  instance:</div><div>    hostname: localhost #Eureka服务端的实例名称</div><div>  client:</div><div>    register-with-eureka: false #表示是否向eureka注册自己</div><div>    fetch-registry: false #false表示自己为注册中心</div><div>    service-url: #监控页面</div><div>      #单机：defaultZone:  http://${eureka.instance.hostname}:${server.port}/eureka</div><div>      #集群：</div><div>      defaultZone: http://localhost:7001/eureka/,http://localhost:7003/eureka/</div></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>server:</div><div>  port: 7003</div><div><br/></div><div><br/></div><div>#Eureak</div><div>eureka:</div><div>  instance:</div><div>    hostname: localhost #Eureka服务端的实例名称</div><div>  client:</div><div>    register-with-eureka: false #表示是否向eureka注册自己</div><div>    fetch-registry: false #false表示自己为注册中心</div><div>    service-url: #监控页面</div><div>      #单机：defaultZone:  http://${eureka.instance.hostname}:${server.port}/eureka</div><div>      #集群：</div><div>      defaultZone: http://localhost:7001/eureka/,http://localhost:7002/eureka/</div></div><div><br/></div><div>然后更改 服务提供者，让其发布到 三台eureka server上</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>server:</div><div>  port: 8001</div><div><br/></div><div><br/></div><div>#mybatis配置</div><div>mybatis:</div><div>  type-aliases-package: com.springcloud.pojo</div><div>  config-location:  classpath:mybatis/mybatis-config.xml</div><div>  mapper-locations: classpath:mybatis/mapper/*.xml</div><div>#spring配置</div><div>spring:</div><div>  application:</div><div>    name: springcloud-provider-dept</div><div>  datasource:</div><div>    type: com.alibaba.druid.pool.DruidDataSource #数据源</div><div>    driver-class-name: com.mysql.cj.jdbc.Driver</div><div>    url: jdbc:mysql://localhost:3306/db01?useUnicode=true&amp;characterEncoding=utf-8&amp;serverTimezone=GMT%2B8</div><div>    username: root</div><div>    password: 2019936206</div><div><br/></div><div><br/></div><div>#Eureka的配置，服务注册到哪里</div><div>eureka:</div><div>  client:</div><div>    service-url:</div><div>      defaultZone: http://localhost:7001/eureka/,http://localhost:7002/eureka/,http://localhost:7003/eureka/</div><div>  instance:</div><div>    instance-id: springcloud-provider-dept-8001 #修改eureak上的默认描述信息</div><div>#info配置（actuator 完善监控信息,告知需要调用该服务的信息）</div><div>info:</div><div>  app.name: lk</div><div>  company: qtz.com</div><div><br/></div></div><div><br/></div><div><br/></div><div><span style="font-weight: bold; font-size: 12pt;">Eureka对比Zookeeper</span><img src="Eureka服务注册与发现_files/Image [6].png" type="image/png" data-filename="Image.png" style="color: unset; font-family: unset; font-size: unset;"/></div><div><img src="Eureka服务注册与发现_files/Image [7].png" type="image/png" data-filename="Image.png"/></div><div><img src="Eureka服务注册与发现_files/Image [8].png" type="image/png" data-filename="Image.png"/></div><div><img src="Eureka服务注册与发现_files/Image [9].png" type="image/png" data-filename="Image.png"/></div><div><img src="Eureka服务注册与发现_files/Image [10].png" type="image/png" data-filename="Image.png"/></div><div><img src="Eureka服务注册与发现_files/Image [11].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><h2 style="margin-top: 10px; font-size: 1em; color: rgb(0, 0, 0); font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(238, 238, 221);"><a href="https://www.cnblogs.com/whalesea/p/12846088.html" style="font-size: 1em; color: rgb(119, 0, 0); font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(238, 238, 221); vertical-align: middle; text-decoration: underline;">@EnableDiscoveryClient和@EnableEurekaClient的区别</a></h2><div style="margin-bottom: 20px; word-break: break-word; color: rgb(0, 0, 0); font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 14.4px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(238, 238, 221);"><div style="margin: 10px auto; line-height: 1.5; text-indent: 0px;"><span style="line-height: 1.5; text-indent: 0px;">简单区分下，他们在功能上是一致的：写在启动类的上，开启服务注册发现功能。</span></div><div style="margin: 10px auto; line-height: 1.5; text-indent: 0px;"><span style="line-height: 1.5; text-indent: 0px;">不同的是，当注册中心不一样时，像：eureka、consul、zookeeper，使用是也有了区别。</span></div><div style="margin: 10px auto; line-height: 1.5; text-indent: 0px;"><span style="line-height: 1.5; text-indent: 0px;">EnableDiscoveryClient注解在common包中，通过项目的classpath来决定使用哪种实现，而EnableEurekaClient注解在netflix包中，只会使用eureka这种实现方式；</span></div><div style="margin: 10px auto; line-height: 1.5; text-indent: 0px;"><span style="line-height: 1.5; text-indent: 0px;">所以，使用EnableDiscoverClient，对任何注册中心都适用。而EnableEurekaClient是为eureka服务的。</span></div></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></div></span>
</div></body></html> 