<html>
<head>
  <title>Hystrix：服务熔断</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/602916 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="6488"/>
<h1>Hystrix：服务熔断</h1>

<div>
<span><div><div><span style="font-size: 12pt; font-weight: bold;">分布式系统面临的问题：</span></div><div>    复杂的分布式系统有很多的依赖关系，每个依赖关系在某些时候将不可避免的失败。</div><div><br/></div><div><span style="font-size: 12pt; font-weight: bold;">服务雪崩：</span></div><div>    多个微服务之间调用的时候，假设微服务A调用微服务B和微服务C，微服务B和C又调用 其他的微服务，这就是所谓的“扇出”、如果扇出的链路上某个微服务的调用响应时间过长或者不可用，对微服务A的调用就会占用越来越多的系统资源，进而引发系统崩溃，所谓的“雪崩效应”。</div><div>    对于高流量的应用来说，单一的后台依赖可能导致所有的服务器上的所有资源在几秒钟中内饱和。比失败更糟糕的是，这些应用程序还可能导致服务之间的延迟增加，备份队列，线程和其他系统资源紧张，导致整个系统发生更多的级联故障，这些都表示需要对故障和延迟进行隔离和管理，以便单个依赖关系的失败，不能取消整个应用进程或系统。</div><div>    需要 “”弃车保帅“”</div><div><img src="Hystrix：服务熔断_files/Image.png" type="image/png" data-filename="Image.png"/></div><div><span style="font-size: 12pt; font-weight: bold;">什么是Hystrix？</span></div><div><img src="Hystrix：服务熔断_files/Image [1].png" type="image/png" data-filename="Image.png"/></div><div><span style="font-size: 12pt; font-weight: bold;">Nystrix能干嘛？</span></div><div>    》服务降级</div><div>    》服务熔断</div><div>    》服务限流</div><div>    》接近实时的监控</div><div>    》。。。。</div><div><br/></div><div>官网地址：https://github.com/Netfix/Hystrix/wiki</div><div><br/></div><div><span style="font-size: 12pt; font-weight: bold;">服务熔断（保险丝）</span></div><div><span style="font-size: 12pt; font-weight: bold;">    服务出现异常，当某个异常条件被触发时，直接熔断该服务 ,而不是一直等到服务超时。</span></div><div><img src="Hystrix：服务熔断_files/Image [2].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>1、添加新的服务提供者springcloud-provider-dept-hystrix-8001</div><div>2、添加依赖</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</div><div>&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;</div><div>         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</div><div>         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;</div><div>    &lt;parent&gt;</div><div>        &lt;artifactId&gt;SpringCloud&lt;/artifactId&gt;</div><div>        &lt;groupId&gt;org.example&lt;/groupId&gt;</div><div>        &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</div><div>    &lt;/parent&gt;</div><div>    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</div><div><br/></div><div><br/></div><div>    &lt;artifactId&gt;springcloud-provider-dept-hystrix-8001&lt;/artifactId&gt;</div><div>    &lt;dependencies&gt;</div><div>        &lt;!--hystrix 服务熔断--&gt;</div><div>        &lt;dependency&gt;</div><div>            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</div><div>            &lt;artifactId&gt;spring-cloud-starter-hystrix&lt;/artifactId&gt;</div><div>            &lt;version&gt;1.4.6.RELEASE&lt;/version&gt;</div><div>        &lt;/dependency&gt;</div><div>        &lt;!--服务提供者eureka的依赖--&gt;</div><div>        &lt;dependency&gt;</div><div>            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</div><div>            &lt;artifactId&gt;spring-cloud-starter-eureka&lt;/artifactId&gt;</div><div>            &lt;version&gt;1.4.6.RELEASE&lt;/version&gt;</div><div>        &lt;/dependency&gt;</div><div>        &lt;!--actuator 完善监控信息--&gt;</div><div>        &lt;dependency&gt;</div><div>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div>            &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;</div><div>        &lt;/dependency&gt;</div><div><br/></div><div><br/></div><div>        &lt;!--需要拿到实体类，需要配置API module--&gt;</div><div>        &lt;dependency&gt;</div><div>            &lt;groupId&gt;org.example&lt;/groupId&gt;</div><div>            &lt;artifactId&gt;springcloud-api&lt;/artifactId&gt;</div><div>            &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</div><div>        &lt;/dependency&gt;</div><div>        &lt;!--junit--&gt;</div><div>        &lt;dependency&gt;</div><div>            &lt;groupId&gt;junit&lt;/groupId&gt;</div><div>            &lt;artifactId&gt;junit&lt;/artifactId&gt;</div><div>        &lt;/dependency&gt;</div><div>        &lt;dependency&gt;</div><div>            &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt;</div><div>            &lt;artifactId&gt;logback-core&lt;/artifactId&gt;</div><div>        &lt;/dependency&gt;</div><div>        &lt;dependency&gt;</div><div>            &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt;</div><div>            &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt;</div><div>        &lt;/dependency&gt;</div><div>        &lt;!--test--&gt;</div><div>        &lt;dependency&gt;</div><div>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div>            &lt;artifactId&gt;spring-boot-test&lt;/artifactId&gt;</div><div>        &lt;/dependency&gt;</div><div>        &lt;dependency&gt;</div><div>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div>            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</div><div>        &lt;/dependency&gt;</div><div>        &lt;!--热部署--&gt;</div><div>        &lt;dependency&gt;</div><div>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div>            &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;</div><div>        &lt;/dependency&gt;</div><div>    &lt;/dependencies&gt;</div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div>&lt;/project&gt;</div></div><div>3、配置文件application.yml</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>server:</div><div>  port: 8001</div><div><br/></div><div><br/></div><div>#mybatis配置</div><div>mybatis:</div><div>  type-aliases-package: com.springcloud.pojo</div><div>  config-location:  classpath:mybatis/mybatis-config.xml</div><div>  mapper-locations: classpath:mybatis/mapper/*.xml</div><div>#spring配置</div><div>spring:</div><div>  application:</div><div>    name: springcloud-provider-dept #三个服务名称一致</div><div>  datasource:</div><div>    type: com.alibaba.druid.pool.DruidDataSource #数据源</div><div>    driver-class-name: com.mysql.cj.jdbc.Driver</div><div>    url: jdbc:mysql://localhost:3306/db01?useUnicode=true&amp;characterEncoding=utf-8&amp;serverTimezone=GMT%2B8</div><div>    username: root</div><div>    password: 2019936206</div><div><br/></div><div><br/></div><div>#Eureka的配置，服务注册到哪里</div><div>eureka:</div><div>  client:</div><div>    service-url:</div><div>      defaultZone: http://localhost:7001/eureka/,http://localhost:7002/eureka/,http://localhost:7003/eureka/</div><div>  instance:</div><div>    instance-id: springcloud-provider-dept-hystrix-8001 #修改eureak上的默认描述信息</div><div>    prefer-ip-address: true #true,注册中心左下角可以看到ip地址</div><div>#info配置（actuator 完善监控信息,告知需要调用该服务的信息）</div><div>info:</div><div>  app.name: lk</div><div>  company: qtz.com</div><div><br/></div><div><br/></div></div><div>4、编写service（DIUD）</div><div>5、Controller</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>package com.springcloud.controller;</div><div><br/></div><div><br/></div><div>import com.fasterxml.jackson.databind.ObjectMapper;</div><div>import com.netflix.hystrix.contrib.javanica.annotation.HystrixCommand;</div><div>import com.springcloud.pojo.Dept;</div><div>import com.springcloud.service.DeptService;</div><div>import org.checkerframework.checker.units.qual.A;</div><div>import org.springframework.beans.factory.annotation.Autowired;</div><div>import org.springframework.cloud.client.ServiceInstance;</div><div>import org.springframework.cloud.client.discovery.DiscoveryClient;</div><div>import org.springframework.web.bind.annotation.GetMapping;</div><div>import org.springframework.web.bind.annotation.PathVariable;</div><div>import org.springframework.web.bind.annotation.PostMapping;</div><div>import org.springframework.web.bind.annotation.RestController;</div><div><br/></div><div><br/></div><div>import java.util.List;</div><div><br/></div><div><br/></div><div>/**</div><div>* @Auther:LiKang</div><div>* @Date:2021/8/22 -08 -22 -15:13</div><div>* @Description: com.springcloud.controller</div><div>* @version: 1.0</div><div>*/</div><div>//提供RestController服务</div><div>@RestController</div><div>public class DeptController {</div><div>    @Autowired</div><div>    private DeptService deptService;</div><div><br/></div><div><br/></div><div>    @GetMapping(&quot;/dept/get/{id}&quot;)</div><div>   <font style="color: rgb(227, 0, 0);"> <b>@HystrixCommand(fallbackMethod =&quot;hystriyget&quot;)</b></font></div><div>    public Dept get(@PathVariable(&quot;id&quot;)Long id){</div><div>        Dept dept=deptService.queryById(id);</div><div>        if(dept==null){</div><div>            //运行时异常不捕获就崩了</div><div>            throw new RuntimeException(&quot;id&quot;+id+&quot;--不存在&quot;);</div><div>        }</div><div>        return dept;</div><div>    }</div><div>    //备选方案</div><div>    public Dept hystriyget(Long id){</div><div>       return new Dept().setDeptno(id).setDname(&quot;id&quot;+id+&quot;不存在&quot;);</div><div>    }</div><div>    }</div><div><br/></div><div><br/></div></div><div><span style="color: rgb(227, 0, 0); font-weight: bold;">@HystrixCommand(fallbackMethod =&quot;hystriyget&quot;)</span></div><div><span style="color: rgb(227, 0, 0); font-weight: bold;">表示：将整个方法返回，在服务崩溃（运行时异常，断电，网络堵塞）时，调用该服务的备用方法。</span></div><hr/><div><br/></div><div>6、主启动类</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>package com.springcloud;</div><div><br/></div><div><br/></div><div>import org.springframework.boot.SpringApplication;</div><div>import org.springframework.boot.autoconfigure.SpringBootApplication;</div><div>import org.springframework.cloud.client.circuitbreaker.EnableCircuitBreaker;</div><div>import org.springframework.cloud.netflix.eureka.EnableEurekaClient;</div><div><br/></div><div><br/></div><div>/**</div><div>* @Auther:LiKang</div><div>* @Date:2021/8/22 -08 -22 -15:19</div><div>* @Description: com.springcloud</div><div>* @version: 1.0</div><div>*/</div><div>//启动类</div><div><b><font color="#FF0000">@EnableCircuitBreaker//添加对熔断的支持</font></b></div><div>@EnableEurekaClient //在服务启动后自动注册到Eureka server中</div><div>@SpringBootApplication</div><div>public class DeptProvider_hystrix_8001 {</div><div>    public static void main(String[] args) {</div><div>        SpringApplication.run(DeptProvider_hystrix_8001.class,args);</div><div>    }</div><div>}</div></div><div><br/></div><div><span style="font-size: 12pt; font-weight: bold;">服务降级</span></div><div><img src="Hystrix：服务熔断_files/Image [3].png" type="image/png" data-filename="Image.png"/></div><div>    假设在一段时间内，A服务的访问量特别大，而B，C的访问量特别小，公司需要将<span style="font-size: unset; color: unset; font-family: unset;">B，C服务先停掉，将集群的所有资源放在A服务上，这个时候用户访问BC服务应该返回一些提示信息。</span></div><div><br/></div><div>在springcloud-api的service包中编写 服务降级返回的类DeptClinentServiceFallbackFactory。实现FallbackFactory接口，实现该接口的create 方法。</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>package com.springcloud.service;</div><div><br/></div><div><br/></div><div>import com.springcloud.pojo.Dept;</div><div>import feign.hystrix.FallbackFactory;</div><div>import org.springframework.context.annotation.ComponentScan;</div><div>import org.springframework.stereotype.Component;</div><div><br/></div><div><br/></div><div>import java.util.List;</div><div><br/></div><div><br/></div><div>/**</div><div>* @Auther:LiKang</div><div>* @Date:2021/8/24 -08 -24 -16:31</div><div>* @Description: com.springcloud.service</div><div>* @version: 1.0</div><div>*/</div><div>//配置服务降级</div><div><b><font color="#E30000">@Component //创建对象交给spring管理，在服务降级的时候，将该对象返回给客户</font></b></div><div>public class DeptClinentServiceFallbackFactory implements FallbackFactory {</div><div>    @Override</div><div>    public Object create(Throwable throwable) {</div><div>        return new DeptClinentService() {</div><div>            @Override</div><div>            public Dept queryById(Long id) {</div><div>                return new Dept().setDeptno(id).setDname(&quot;id==&gt;&quot;+id+&quot;没有对应的信息，现在正在服务降级，该服务不可用&quot;);</div><div>            }</div><div><br/></div><div><br/></div><div>            @Override</div><div>            public List&lt;Dept&gt; queryAll() {</div><div>                return null;</div><div>            }</div><div><br/></div><div><br/></div><div>            @Override</div><div>            public boolean addDept(Dept dept) {</div><div>                return false;</div><div>            }</div><div>        };</div><div>    }</div><div>}</div></div><div>在springcloud-api 里springcloud.service.DeptClinentService</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>package com.springcloud.service;</div><div><br/></div><div><br/></div><div>import com.springcloud.pojo.Dept;</div><div>import org.springframework.cloud.openfeign.FeignClient;</div><div>import org.springframework.stereotype.Component;</div><div>import org.springframework.web.bind.annotation.*;</div><div><br/></div><div><br/></div><div>import java.util.List;</div><div><br/></div><div><br/></div><div>/**</div><div>* @Auther:LiKang</div><div>* @Date:2021/8/23 -08 -23 -20:49</div><div>* @Description: com.springcloud.service</div><div>* @version: 1.0</div><div>*/</div><div>@Component</div><div>@FeignClient(value=&quot;SPRINGCLOUD-PROVIDER-DEPT&quot;,<b><font color="#FF0000">fallbackFactory = DeptClinentServiceFallbackFactory.class</font></b>)<font color="#FF0000"><b>//配置服务降级</b></font></div><div>public interface DeptClinentService {</div><div>    @GetMapping(&quot;/dept/get/{id}&quot;)</div><div>     Dept queryById(@PathVariable(&quot;id&quot;) Long id);</div><div>    @GetMapping(&quot;/dept/list&quot;)</div><div>    List&lt;Dept&gt; queryAll();</div><div>    @PostMapping(&quot;/dept/add&quot;)</div><div>     boolean addDept(Dept dept);</div><div>}</div></div><div><br/></div><div><br/></div><div>在springcloud-consumer-dept-feign的applciation.yml</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>server:</div><div>  port: 80</div><div><br/></div><div><br/></div><div><b><font color="#FF0000">#开启降级 feign.hystrix</font></b></div><div><b><font color="#FF0000">feign:</font></b></div><div><b><font color="#FF0000">  hystrix:</font></b></div><div><b><font color="#FF0000">    enabled: true</font></b></div><div>#Erreka配置</div><div>eureka:</div><div>  client:</div><div>    register-with-eureka: false #不向eureka中注册自己</div><div>    service-url:</div><div>      defaultZone: http://localhost:7001/eureka/,http://localhost:7002/eureka/,http://localhost:7003/eureka/</div></div><div><span style="font-weight: bold;">》服务熔断配置是在服务提供方，服务降级配置在服务消费方。</span></div><div>》服务熔断是服务的消费方可以连接到服务的提供方，但是由于某种原因请求卡住了（异常。。），这个时候就需要服务熔断，终止请求并快速返回一个结果；</div><div>》服务降级是服务的消费方连接不上服务的提供方，服务的提供方给客户发出默认的提示。</div><div><br/></div><div>实验：如果仅仅配置了服务降级，而没有配置服务熔断。可能出现服务的消费方可以连接上服务的提供方，但是请求一直没有结果，导致服务雪崩（可能是服务的逻辑问题或者异常）。</div><div><span style="color: rgb(227, 0, 0); font-weight: bold;">感觉：服务熔断才是保障微服务架构健康的大头。</span></div><div><img src="Hystrix：服务熔断_files/Image [4].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div><br/></div><div><span style="font-size: 12pt; font-weight: bold;">Hystrix：Dashboard流监控</span></div><div>    1、创建一个项目，专门提供对服务的监控springcloud-consumer-hystrix-dashboard</div><div>    2、添加依赖</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</div><div>&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;</div><div>         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</div><div>         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;</div><div>    &lt;parent&gt;</div><div>        &lt;artifactId&gt;SpringCloud&lt;/artifactId&gt;</div><div>        &lt;groupId&gt;org.example&lt;/groupId&gt;</div><div>        &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</div><div>    &lt;/parent&gt;</div><div>    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</div><div><br/></div><div><br/></div><div>    &lt;artifactId&gt;springcloud-consumer-hysyrix-dashboard&lt;/artifactId&gt;</div><div>    &lt;dependencies&gt;</div><div>        &lt;!--Hystrix--&gt;</div><div>        &lt;dependency&gt;</div><div>            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</div><div>            &lt;artifactId&gt;spring-cloud-starter-hystrix&lt;/artifactId&gt;</div><div>            &lt;version&gt;1.4.6.RELEASE&lt;/version&gt;</div><div>        &lt;/dependency&gt;</div><div>        &lt;!--hystrix-dashboard监控--&gt;</div><div>        &lt;dependency&gt;</div><div>            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</div><div>            &lt;artifactId&gt;spring-cloud-starter-hystrix-dashboard&lt;/artifactId&gt;</div><div>            &lt;version&gt;1.4.6.RELEASE&lt;/version&gt;</div><div>        &lt;/dependency&gt;</div><div>        &lt;!--使用feign代替ribbon--&gt;</div><div>        &lt;!--feign--&gt;</div><div>        &lt;dependency&gt;</div><div>            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</div><div>            &lt;artifactId&gt;spring-cloud-starter-feign&lt;/artifactId&gt;</div><div>            &lt;version&gt;1.4.6.RELEASE&lt;/version&gt;</div><div>        &lt;/dependency&gt;</div><div><br/></div><div><br/></div><div>        &lt;!--eureka--&gt;</div><div>        &lt;dependency&gt;</div><div>            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</div><div>            &lt;artifactId&gt;spring-cloud-starter-eureka&lt;/artifactId&gt;</div><div>            &lt;version&gt;1.4.6.RELEASE&lt;/version&gt;</div><div>        &lt;/dependency&gt;</div><div><br/></div><div><br/></div><div>        &lt;!--实体类--&gt;</div><div>        &lt;dependency&gt;</div><div>            &lt;groupId&gt;org.example&lt;/groupId&gt;</div><div>            &lt;artifactId&gt;springcloud-api&lt;/artifactId&gt;</div><div>            &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</div><div>        &lt;/dependency&gt;</div><div>        &lt;!--springboot web --&gt;</div><div>        &lt;dependency&gt;</div><div>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div>            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</div><div>        &lt;/dependency&gt;</div><div>        &lt;!--热部署--&gt;</div><div>        &lt;dependency&gt;</div><div>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div>            &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;</div><div>        &lt;/dependency&gt;</div><div>    &lt;/dependencies&gt;</div><div><br/></div><div><br/></div><div>&lt;/project&gt;</div></div><div>    3、配置文件</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>server:</div><div>  port: 9001</div><div>hystrix:</div><div>  dashboard:</div><div>    proxy-stream-allow-list: &quot;localhost&quot;</div></div><div>    4、添加主启动类</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>package com.springcloud;</div><div><br/></div><div><br/></div><div>import org.springframework.boot.SpringApplication;</div><div>import org.springframework.boot.autoconfigure.SpringBootApplication;</div><div>import org.springframework.cloud.netflix.hystrix.EnableHystrix;</div><div>import org.springframework.cloud.netflix.hystrix.dashboard.EnableHystrixDashboard;</div><div><br/></div><div><br/></div><div>/**</div><div>* @Auther:LiKang</div><div>* @Date:2021/8/24 -08 -24 -20:17</div><div>* @Description: com.springcloud</div><div>* @version: 1.0</div><div>*/</div><div>@SpringBootApplication</div><div><b><font color="#FF0000">@EnableHystrixDashboard //开启Dashboard监控</font></b></div><div>public class hysyrix_dashboard {</div><div>    public static void main(String[] args) {</div><div>        SpringApplication.run(hysyrix_dashboard.class,args);</div><div>    }</div><div>}</div></div><div><br/></div><div>注意：服务的提供方需要添加下面的依赖才可以被监控到</div><div>            服务的提供方需要使用hystrix熔断（否则监听不到，发现访问 <a href="http://localhost:8001/actuator/hystrix.stream">http://localhost:8001/actuator/hystrix.stream</a> ，一直ping的是空数据）。</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>&lt;!--actuator 完善监控信息--&gt;</div><div>&lt;dependency&gt;</div><div>    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div>    &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;</div><div>&lt;/dependency&gt;</div></div><div>在服务端增加一个ServletBean</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>//增加一个servlte，为了hystrix-dashboard监控</div><div>@Bean</div><div>public ServletRegistrationBean hystrixMetricsStreamServlet(){</div><div>    ServletRegistrationBean registrationBean=new ServletRegistrationBean(new HystrixMetricsStreamServlet());</div><div>    registrationBean.addUrlMappings(&quot;/actuator/hystrix.stream&quot;);</div><div>    return registrationBean;</div><div>}</div></div><div><br/></div><div>开启服务：访问 http://ip:端口/hystrix</div><div>填写需要监控服务信息：</div><div>    监控地址：<a href="http://localhost:8001/actuator/hystrix.stream">http://localhost:8001/actuator/hystrix.stream</a></div></div><div>    监控间隔：</div><div>    监控名称：</div><div><img src="Hystrix：服务熔断_files/Image [5].png" type="image/png" data-filename="Image.png"/></div><div><img src="Hystrix：服务熔断_files/Image [6].png" type="image/png" data-filename="Image.png"/></div><div><img src="Hystrix：服务熔断_files/Image [7].png" type="image/png" data-filename="Image.png"/></div><div><img src="Hystrix：服务熔断_files/Image [8].png" type="image/png" data-filename="Image.png"/>    </div><div><img src="Hystrix：服务熔断_files/Image [9].png" type="image/png" data-filename="Image.png"/></div><div><br/></div></span>
</div></body></html> 