<html>
<head>
  <title>Ribbon：负载均衡</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/602916 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="6466"/>
<h1>Ribbon：负载均衡</h1>

<div>
<span><div><span style="font-size: 11pt; font-weight: bold;">Ribbon是什么？</span></div><div><img src="Ribbon：负载均衡_files/Image.png" type="image/png" data-filename="Image.png"/></div><div><span style="font-size: 11pt; font-weight: bold;">Ribbon能干嘛？</span></div><div><img src="Ribbon：负载均衡_files/Image [1].png" type="image/png" data-filename="Image.png"/></div><div>客户端集成Ribbo</div><div>     springcloud- consumer-dept-80</div><div>    加入依赖</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>&lt;!--Ribbon--&gt;</div><div>&lt;dependency&gt;</div><div>    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</div><div>    &lt;artifactId&gt;spring-cloud-starter-ribbon&lt;/artifactId&gt;</div><div>    &lt;version&gt;1.4.6.RELEASE&lt;/version&gt;</div><div>&lt;/dependency&gt;</div><div>&lt;!--eureka--&gt;</div><div>&lt;dependency&gt;</div><div>    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</div><div>    &lt;artifactId&gt;spring-cloud-starter-eureka&lt;/artifactId&gt;</div><div>    &lt;version&gt;1.4.6.RELEASE&lt;/version&gt;</div><div>&lt;/dependency&gt;</div></div><div>    增加配置</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>server:</div><div>  port: 80</div><div>#Erreka配置</div><div>eureka:</div><div>  client:</div><div>    register-with-eureka: false #不向eureka中注册自己</div><div>    service-url:</div><div>      defaultZone: http://localhost:7001/eureka/,http://localhost:7002/eureka/,http://localhost:7003/eureka/</div></div><div>    主启动类</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>package com.springcloud;</div><div><br/></div><div><br/></div><div>import org.springframework.boot.SpringApplication;</div><div>import org.springframework.boot.autoconfigure.SpringBootApplication;</div><div>import org.springframework.cloud.netflix.eureka.EnableEurekaClient;</div><div><br/></div><div><br/></div><div>import javax.xml.crypto.Data;</div><div><br/></div><div><br/></div><div>/**</div><div>* @Auther:LiKang</div><div>* @Date:2021/8/22 -08 -22 -22:57</div><div>* @Description: com.springcloud</div><div>* @version: 1.0</div><div>*/</div><div>//Ribbon和Eureka集成之后，客户端可以直接调用，不用关心IP地址和端口号</div><div>@EnableEurekaClient //表示是eureka的客户端</div><div>@SpringBootApplication</div><div>public class DeptConsumer_80 {</div><div>    public static void main(String[] args) {</div><div>        SpringApplication.run(DeptConsumer_80.class,args);</div><div>    }</div><div>}</div></div><div>    配置类</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>package com.springcloud.config;</div><div><br/></div><div><br/></div><div>import org.springframework.cloud.client.loadbalancer.LoadBalanced;</div><div>import org.springframework.context.annotation.Bean;</div><div>import org.springframework.context.annotation.Configuration;</div><div>import org.springframework.web.bind.annotation.RestController;</div><div>import org.springframework.web.client.RestTemplate;</div><div><br/></div><div><br/></div><div>/**</div><div>* @Auther:LiKang</div><div>* @Date:2021/8/22 -08 -22 -22:31</div><div>* @Description: com.springcloud.config</div><div>* @version: 1.0</div><div>*/</div><div>@Configuration//配置类</div><div>public class ConfigBean {</div><div>    @Bean</div><div>    @LoadBalanced//Ribbon 配置负载均衡实现RestTemplate</div><div>    public RestTemplate getRestTemplate(){</div><div>        return new RestTemplate();</div><div>    }</div><div><br/></div><div><br/></div><div>}</div></div><div>      DeptConsumer</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>package com.springcloud.controller;</div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div>import com.springcloud.pojo.Dept;</div><div>import com.sun.org.apache.regexp.internal.RE;</div><div>import org.springframework.beans.factory.annotation.Autowired;</div><div>import org.springframework.web.bind.annotation.PathVariable;</div><div>import org.springframework.web.bind.annotation.RequestMapping;</div><div>import org.springframework.web.bind.annotation.ResponseStatus;</div><div>import org.springframework.web.bind.annotation.RestController;</div><div>import org.springframework.web.client.RestTemplate;</div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div>import java.util.List;</div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div>/**</div><div>* @Auther:LiKang</div><div>* @Date:2021/8/22 -08 -22 -22:27</div><div>* @Description: com.springcloud.controller</div><div>* @version: 1.0</div><div>*/</div><div>@RestController</div><div>public class DeptConsumerController {</div><div>    //理解：消费者，不应该有server层</div><div>    //RestTemplate .....供我们直接调用就可以了，注册到Spring中</div><div>    //(url,实体：Map，Class&lt;T&gt; reponseType)</div><div>    @Autowired</div><div>    private RestTemplate restTemplate;//提供多种便捷访问远程http服务的方法，简单的restful服务模板</div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div>    //private static  final String REST_URL_PREFIX=&quot;http://localhost:8001&quot;;//写死了访问的地址（相当于直连）</div><div>    //Ribbon实现负载均衡，这里的地址应该是一个变量，通过服务名来访问</div><div>    private static  final String REST_URL_PREFIX=&quot;http://SPRINGCLOUD-PROVIDER-DEPT&quot;;</div><div>    @RequestMapping(&quot;/consumer/dept/get/{id}&quot;)</div><div>    public Dept get(@PathVariable(&quot;id&quot;)Long id){</div><div>        return restTemplate.getForObject(REST_URL_PREFIX+&quot;/dept/get/&quot;+id,Dept.class);</div><div>    }</div><div>    @RequestMapping(&quot;/consumer/dept/add&quot;)</div><div>    public boolean add(Dept dept){</div><div>        return restTemplate.postForObject(REST_URL_PREFIX+&quot;/dept/add&quot;,dept,Boolean.class);</div><div>    }</div><div>    @RequestMapping(&quot;/consumer/dept/list&quot;)</div><div>    public List&lt;Dept&gt; queryAll(){</div><div>        return restTemplate.getForObject(REST_URL_PREFIX+&quot;/dept/list&quot;,List.class);</div><div>    }</div><div>}</div></div><div>    上面是</div><div><img src="Ribbon：负载均衡_files/Image [2].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>使用Ribbon实现负载均衡</div><div><img src="Ribbon：负载均衡_files/Image [3].png" type="image/png" data-filename="Image.png"/></div><div>1、再创建两个数据库</div><div>2、增加另个服务的提供者（和原先一样）</div><div><span>    </span><br/></div><div><span><b><font style="font-size: 12pt;">Ribbon：自定义负载均衡算法</font></b></span></div><div><span><br/></span></div><div><span>    </span>IRule接口</div><div><span>    实现类：</span><br/></div><div><span>这里留个问题：实现自定义负载均衡算法。</span></div><div><span><br/></span></div><div><span><br/></span></div><div><span><span>    </span><span>    </span><br/></span></div><div><span>    </span><br/></div><div><br/></div><div><br/></div><div><br/></div></span>
</div></body></html> 