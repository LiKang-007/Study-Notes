<html>
<head>
  <title>spring的事务处理</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/602916 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="2742"/>
<h1>spring的事务处理</h1>

<div>
<span><div><a href="https://blog.csdn.net/weixin_28717647/article/details/113012600?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522161831447716780366544297%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&amp;request_id=161831447716780366544297&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_v2~rank_v29-2-113012600.pc_search_result_hbase_insert&amp;utm_term=spring+%E7%9A%84%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB%E8%AF%A6%E8%A7%A3&amp;spm=1018.2226.3001.4187">https://blog.csdn.net/weixin_28717647/article/details/113012600?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522161831447716780366544297%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&amp;request_id=161831447716780366544297&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_v2~rank_v29-2-113012600.pc_search_result_hbase_insert&amp;utm_term=spring+%E7%9A%84%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB%E8%AF%A6%E8%A7%A3&amp;spm=1018.2226.3001.4187</a></div><div><br/></div><div>问题：</div><div>    1、什么是事务？</div><div>            事务是指一组sql语句的集合，集合中有多条语句， 我们希望这些多条语句，都成功或者都失败，sql语句的执行时一致的，作为一个整体执行。</div><div>    2、什么时候使用事务？</div><div>            当操作，涉及到多个表，或者是多个sql语句的insert，updata，delete。需要保证这些语句都成功或者都失败，才能保证操作是符合要求的。</div><div>        在java程序中，控制事务的语句应该放在哪里？</div><div>            在services业务类的业务方法上。</div><div>    3、JDBC处理事务的方式？mybatis处理事务的方式？</div><div>        jdbc访问数据库，处理事务 Connection conn；conn.commit();conn.rollback();</div><div>        mybatis,SqlSession.commit();SqlSession.rollback();</div><div>    4、问题三中事务的处理方式有什么不足？</div><div>        1&gt;不同的数据库访问技术，处理事务的对象，方法不同。需要了解不同数据库访问技术使用事务的原理。</div><div>        2&gt;掌握多种数据库中事务的处理逻辑，什么时候提交事务，什么时候回滚事务。</div><div>        3&gt;处理事务的多种方法。</div><div>        总结：就是多种数据库的方法技术，有不同的事务处理的机制，对象，方法。</div><div>    5、怎么解决该不足?</div><div>        spring提供了一种处理事务的统一模型，使用统一步骤，方式完成多种数据库访问技术的事务处理。</div><div>        <img src="spring的事务处理_files/Image.png" type="image/png" data-filename="Image.png"/></div><div>    6、处理事务，需要怎么做？做什么？</div><div>        spring处理事务的模型，使用的步骤都是固定的。把事务使用的信息提供给spring就可以了。</div><div>      <span style="font-weight: bold;">  1&gt;事务内部提交，回滚事务，使用的是事务管理器对象，代替开发人员完成commit，rollback。</span></div><div>            事务管理器是一个接口和它的众多实现类。</div><div>                接口： PlatformTransactionManager，定义了事务的重要方法：commit，rollback</div><div>                实现类：sprin把把每一种数据库访问技术对应的事务处理类都创建好了。</div><div>                mybatis访问数据库---spring创建好的是DataSourceTransactionManager</div><div>                hibernate访问数据库---spring创建好的是HibernateTransactionManager</div><div>        </div><div><span style="font-weight: bold;">怎么使用：需要告诉spring，项目应用的是哪种数据库的访问技术：</span></div><div><span style="font-weight: bold;">        在spring的配置文件中使用&lt;bean&gt;声明 数据库访问技术对于事务管理器的实现类。</span></div><div>        例如：使用mybatis访问数据库</div><div>        &lt;bean id=&quot;&quot; class=&quot;...DataSourceTransactionManager&quot;&gt;</div><div><br/></div><div><span style="font-weight: bold;">2&gt;说明需要事务的类型</span></div><div>            说明方法需要的事务：</div><div>                    1&gt;事务的隔离级别：有四个值</div><div><img src="spring的事务处理_files/Image [1].png" type="image/png" data-filename="Image.png"/></div><div>                    2&gt;事务的超时时间：表示一个方法最长的执行时间，如果方法执行时超过了时间，事务就回滚。单位是：秒，整数值，默认是-1.<img src="spring的事务处理_files/Image [2].png" type="image/png" data-filename="Image.png"/></div><div>                    3&gt;事务的传播行为：控制业务方法是是不是有事务的，是什么样的事务。</div><div>                七个传播行为，表示业务方法调用时，事务在方法之间如果是使用的<img src="spring的事务处理_files/Image [3].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>PROPAGATION_REQUIRED<img src="spring的事务处理_files/Image [4].png" type="image/png" data-filename="Image.png"/></div><div><img src="spring的事务处理_files/Image [5].png" type="image/png" data-filename="Image.png"/></div><div>PROPAGATION_SUPPORTS</div><div><img src="spring的事务处理_files/Image [6].png" type="image/png" data-filename="Image.png"/><img src="spring的事务处理_files/Image [7].png" type="image/png" data-filename="Image.png"/></div><div>PROPAGATION_REQUIRES_NEW</div><div><img src="spring的事务处理_files/Image [8].png" type="image/png" data-filename="Image.png"/></div><div><img src="spring的事务处理_files/Image [9].png" type="image/png" data-filename="Image.png"/></div><div><span style="font-weight: bold;">    3&gt;提交事务，回滚事务的时机</span></div><div>            1&gt;当业务方法执行成功，没有异常抛出， spring在方法执行后提交事务。</div><div>            2&gt;当业务方法抛出运行时异常或者ERROR，spring执行回滚。</div><div>                运行时异常的定义：RuntimeException和它的子类都是运行时异常</div><div>            3&gt;当业务方法抛出非运行时异常，主要是受查异常时，提交事务</div><div>                受查异常：必须手动处理的异常。</div><div><br/></div><div><br/></div><div><br/></div><div>spring框架中提供的事务处理方案</div><div>        第一种方案：适合小型项目使用的，注解方案。    </div><div>            spring框架自己使用aop实现给业务方法增加事务的功能，使用    @Transactional注解增加事务。</div><div>    @Transactional注解是spring框架自己的注解，放在public方法的上面，表示当前方法具有事务。可以给注解的属性赋值，表示具体的隔离级别，传播行为，异常信息等等。</div><div>        @Transactional注解的可选属性：</div><div><img src="spring的事务处理_files/Image [10].png" type="image/png" data-filename="Image.png"/></div><div><img src="spring的事务处理_files/Image [11].png" type="image/png" data-filename="Image.png"/><img src="spring的事务处理_files/Image [12].png" type="image/png" data-filename="Image.png" style="color: unset; font-family: unset; font-size: unset;"/></div><div><br/></div><div><img src="spring的事务处理_files/Image [13].png" type="image/png" data-filename="Image.png"/></div><div><img src="spring的事务处理_files/Image [14].png" type="image/png" data-filename="Image.png"/></div><div>annotation-driven是tx结尾的</div><div><img src="spring的事务处理_files/Image [15].png" type="image/png" data-filename="Image.png"/></div><div><img src="spring的事务处理_files/Image [16].png" type="image/png" data-filename="Image.png"/></div><div><img src="spring的事务处理_files/Image [17].png" type="image/png" data-filename="Image.png"/></div><div>  第二种方案：适合大型项目，有很多的类，方法，需要大量的配置事务，使用aspectj框架的功能，在spring配置文件中声明类，方法需要的事务。这种方式业务方法和事务配置完全分离。</div><div>        实现步骤：（都是在xml配置文件中实现的）</div><div>            <img src="spring的事务处理_files/Image [18].png" type="image/png" data-filename="Image.png"/></div><div><img src="spring的事务处理_files/Image [19].png" type="image/png" data-filename="Image.png"/></div><div><img src="spring的事务处理_files/Image [20].png" type="image/png" data-filename="Image.png"/></div><div><img src="spring的事务处理_files/Image [21].png" type="image/png" data-filename="Image.png"/></div><div><img src="spring的事务处理_files/Image [22].png" type="image/png" data-filename="Image.png"/></div><div>总结：</div><div><img src="spring的事务处理_files/Image [23].png" type="image/png" data-filename="Image.png"/></div><div><br/></div></span>
</div></body></html> 